
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dyalog recipes &#8212; Dyalog Cookbook</title>
    
  <link rel="stylesheet" href="_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Content with notebooks" href="notebooks.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Dyalog Cookbook</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Welcome to your Jupyter Book
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active collapsible-parent">
  <a class="reference internal" href="content.html">
   Content in Jupyter Book
  </a>
  <ul class="current collapse-ul">
   <li class="toctree-l2">
    <a class="reference internal" href="markdown.html">
     Markdown Files
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="notebooks.html">
     Content with notebooks
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Dyalog recipes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#fizzbuzz">
     FizzBuzz
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#stdlib">
     Stdlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#trains">
     Trains
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#tack-tricks">
     Tack tricks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#indexing">
     Indexing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#products">
     Products
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#composition-currying">
     Composition (Currying)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#shape-and-rank">
     Shape and Rank
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#folds">
     Folds
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#on-ranges">
     On ranges
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#stencils">
     Stencils
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#key">
     Key
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#sliding-tiles-example">
     Sliding Tiles example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#a-heap-implemented-as-a-leftist-tree">
     A heap implemented as a Leftist Tree
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#strings">
     Strings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="#noddy-hash-table">
     Noddy hash table
    </a>
   </li>
  </ul>
  <i class="fas fa-chevron-down">
  </i>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/Dyalog Cookbook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FDyalog Cookbook.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/Dyalog Cookbook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Dyalog recipes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regular-expressions">
     Regular expressions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fizzbuzz">
   FizzBuzz
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#split-a-string-into-a-vector-of-a-single-char-and-a-number">
     Split a string into a vector of a single char and a number
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partition-a-vector-into-groups-of-equal-elements">
     Partition a vector into groups of equal elements
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#match-brackets">
     Match brackets
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stdlib">
   Stdlib
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-handling">
     Error handling
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sets">
     Sets
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#encode-and-decode">
     Encode and decode ⊤ ⊥
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trains">
   Trains
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#tack-tricks">
   Tack tricks
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#indexing">
   Indexing
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#set-values-with">
     Set values with @
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#products">
   Products
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#composition-currying">
   Composition (Currying)
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#shape-and-rank">
   Shape and Rank
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#folds">
   Folds
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#on-ranges">
   On ranges
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stencils">
   Stencils
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#key">
   Key
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sliding-tiles-example">
   Sliding Tiles example
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-heap-implemented-as-a-leftist-tree">
   A heap implemented as a Leftist Tree
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strings">
   Strings
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binary-operations">
     Binary operations
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#todo-unsorted">
     TODO UNSORTED
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#json">
     JSON
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#namespaces">
     Namespaces
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#introspection-and-typing">
     Introspection and typing
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#performance-comparisons">
     Performance comparisons
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouping">
     Grouping
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#odd-one-out">
     Odd one out
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#partition-a-matrix-into-non-overlapping-sub-matrices-and-re-merge">
     Partition a matrix into non-overlapping sub-matrices – and re-merge
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#neighbourhoods">
     Neighbourhoods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#constrain-a-set-of-coordinates-to-a-rectangle">
     Constrain a set of coordinates to a rectangle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#noddy-hash-table">
   Noddy hash table
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#space-ship-compares">
     Space ship compares (&lt;=&gt;)
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tuples">
     Tuples
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#indices-of-unique">
     Indices of unique
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#namespace-as-dict">
     Namespace as dict
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mapping-between-2d-and-1d-coordinates">
     Mapping between 2D and 1D coordinates
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#generalised-padding">
     Generalised padding
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#todo">
     TODO
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#corners-of-2d-array">
     Corners of 2D Array
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="dyalog-recipes">
<h1>Dyalog recipes<a class="headerlink" href="#dyalog-recipes" title="Permalink to this headline">¶</a></h1>
<p>To see a correct render of this notebook: https://nbviewer.jupyter.org/github/xpqz/DyalogCookbook/blob/master/Dyalog%20Cookbook.ipynb</p>
<p>This notebook contains my notes from learning APL. A lot of these has come from helpful discussions on the APL Orchard Stack Exchange chatroom.</p>
<p>APL allows you to configure the index origin, which is to say if arrays and vectors start at index 0 or 1. The default is 1, and in this notebook this is what we use, to avoid confusion. If you’re used to 0-indexed languages (C, Java, Python etc) this may grate, but in APL it soon feels natural.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="kd">←</span><span class="m">1</span> <span class="c1">⍝ one-based indexing (this is the default, but let&#39;s be explicit)</span>
<span class="sr">]</span><span class="nv">box</span> <span class="nv">on</span> <span class="o">-</span><span class="nv">style</span><span class="o">=</span><span class="nv">max</span> <span class="o">-</span><span class="nv">trains</span><span class="o">=</span><span class="nv">tree</span> <span class="o">-</span><span class="nv">fns</span><span class="o">=</span><span class="nv">on</span> <span class="c1">⍝ Pass all output through DISPLAY</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">done

Rebuilding user command cache... done
</span></div></div>
</div>
<div class="section" id="regular-expressions">
<h2>Regular expressions<a class="headerlink" href="#regular-expressions" title="Permalink to this headline">¶</a></h2>
<p>Dyalog supports the full PCRE syntax via ⎕S and ⎕R</p>
<p>See http://archive.vector.org.uk/art10500870</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Get all words. The config-string &#39;&amp;&#39; returns the matched string.</span>
<span class="s1">&#39;\w+&#39;</span> <span class="nf">⎕S</span> <span class="s1">&#39;&amp;&#39;</span> <span class="o">⊣</span> <span class="s1">&#39;the cat sat on the mat&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────────┐
│Was ON -style=min -trains=tree -fns=on│
└──────────────────────────────────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ ┌→──┐ ┌→──┐ │
│ │the│ │cat│ │sat│ │on│ │the│ │mat│ │
│ └───┘ └───┘ └───┘ └──┘ └───┘ └───┘ │
└∊───────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Reverse each word</span>
<span class="s1">&#39;\w+&#39;</span> <span class="nf">⎕S</span> <span class="kt">{</span><span class="o">⌽</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Match</span><span class="kt">}</span> <span class="o">⊣</span> <span class="s1">&#39;the cat sat on the mat&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ ┌→──┐ ┌→──┐ │
│ │eht│ │tac│ │tas│ │no│ │eht│ │tam│ │
│ └───┘ └───┘ └───┘ └──┘ └───┘ └───┘ │
└∊───────────────────────────────────┘
</span></div></div>
</div>
<p>Note that ⎕S is a dyadic function that returns a function. Left arg is always the pattern. Right arg is either a transformation function or a config string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Capture groups</span>
<span class="s1">&#39;c([^t]+)t&#39;</span> <span class="nf">⎕S</span> <span class="s1">&#39;\1&#39;</span> <span class="o">⊣</span> <span class="s1">&#39;The cabriolet parked on the road&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│ ┌→──────┐ │
│ │abriole│ │
│ └───────┘ │
└∊──────────┘
</span></div></div>
</div>
<p>The config string is used to specify the capture group following Perl conventions, \1, \2 etc. To get all captured groups we have to do a little dance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃,</span><span class="na">/</span><span class="s1">&#39;(hello|goodbye)\s+(\d+)\s+(\d+)&#39;</span><span class="nf">⎕S</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">Lengths</span><span class="o">↑</span><span class="na">¨</span><span class="nv">Offsets</span><span class="o">↓</span><span class="na">¨</span><span class="o">⊂</span><span class="nv">Block</span><span class="p">)</span><span class="kt">}</span> <span class="o">⊢</span> <span class="s1">&#39;hello 123 456&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────┐
│ ┌→────┐ ┌→──┐ ┌→──┐ │
│ │hello│ │123│ │456│ │
│ └─────┘ └───┘ └───┘ │
└∊────────────────────┘
</span></div></div>
</div>
<p>We can make that into a handy function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RegexGroups</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃,</span><span class="na">/</span><span class="bp">⍺</span><span class="nf">⎕S</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">Lengths</span><span class="o">↑</span><span class="na">¨</span><span class="nv">Offsets</span><span class="o">↓</span><span class="na">¨</span><span class="o">⊂</span><span class="nv">Block</span><span class="p">)</span><span class="kt">}</span> <span class="o">⊢</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>The ⎕R function does a replace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;[si]&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;S&#39;</span> <span class="o">⊢</span> <span class="s1">&#39;mississippi&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│mSSSSSSSppS│
└───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;s&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;S&#39;</span><span class="na">⍠</span><span class="s1">&#39;ML&#39;</span> <span class="m">2</span> <span class="o">⊢</span> <span class="s1">&#39;mississippi&#39;</span> <span class="c1">⍝ Set the &quot;match limit&quot; to 2, with the variant operator ⍠</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│miSSissippi│
└───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊃</span><span class="p">(</span><span class="s1">&#39;.+&#39;</span> <span class="nf">⎕S</span> <span class="s1">&#39;\u0&#39;</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span> <span class="s1">&#39;Hello All People in The World&#39;</span> <span class="c1">⍝ Upper-case a string</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────┐
│HELLO ALL PEOPLE IN THE WORLD│
└─────────────────────────────┘
</span></div></div>
</div>
<p>Here’s a dfn that takes a regex and a string and splits the latter on the former:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RegSplit</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="bp">⍺</span><span class="o">∨</span><span class="m">¯1</span><span class="o">⌽</span><span class="bp">⍺</span><span class="kt">}</span><span class="na">/</span><span class="o">↓⍉↑</span><span class="p">(</span><span class="s1">&#39;(.*?)&#39;</span><span class="o">,</span><span class="bp">⍺</span><span class="p">)</span><span class="s1">&#39;(.*?)$&#39;</span><span class="nf">⎕S</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="p">((</span><span class="o">~</span><span class="nv">PatternNum</span><span class="p">)(</span><span class="nv">Lengths</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↑</span><span class="nv">Offsets</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="o">↓</span><span class="nv">Block</span><span class="p">))</span><span class="kt">}</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">RegSplit2</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⊢</span><span class="na">/¨</span><span class="nv">r</span><span class="p">)</span><span class="o">↓</span><span class="na">¨</span><span class="bp">⍵</span><span class="o">⊂</span><span class="na">⍨</span><span class="p">(</span><span class="o">⍳≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∊</span><span class="m">1</span><span class="o">+⊃</span><span class="na">¨</span><span class="nv">r</span><span class="kd">←</span><span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;|^&#39;</span><span class="p">)</span><span class="nf">⎕S</span> <span class="m">0</span> <span class="m">1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ faster</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/+&#39;</span> <span class="nv">RegSplit</span> <span class="s1">&#39;Here///be/dragons/&#39;</span>  <span class="c1">⍝ Note empty last item in result</span>
<span class="s1">&#39;/+&#39;</span> <span class="nv">RegSplit2</span> <span class="s1">&#39;Here///be/dragons/&#39;</span>  <span class="c1">⍝ Note empty last item in result</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────┐
│ ┌→───┐ ┌→─┐ ┌→──────┐ ┌⊖┐ │
│ │Here│ │be│ │dragons│ │ │ │
│ └────┘ └──┘ └───────┘ └─┘ │
└∊──────────────────────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────┐
│ ┌→───┐ ┌→─┐ ┌→──────┐ ┌⊖┐ │
│ │Here│ │be│ │dragons│ │ │ │
│ └────┘ └──┘ └───────┘ └─┘ │
└∊──────────────────────────┘
</span></div></div>
</div>
<p>Branch reset to use the same sub-pattern name for alternatives</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;(?|.*#(\d+).*|.*:(\d\d)).*&#39;</span><span class="nf">⎕r</span><span class="s1">&#39;\1&#39;</span><span class="o">⊢</span><span class="s1">&#39;[1518-02-15 23:58] Guard #3557 begins shift&#39;</span> <span class="s1">&#39;[1518-02-16 00:33] falls asleep&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────┐
│ ┌→───┐ ┌→─┐ │
│ │3557│ │33│ │
│ └────┘ └──┘ │
└∊────────────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="fizzbuzz">
<h1>FizzBuzz<a class="headerlink" href="#fizzbuzz" title="Permalink to this headline">¶</a></h1>
<p>FizzBuzz is a well-known task sometimes set at interviews for coding jobs. The idea is to consider a sequence o f numbers and print “FizzBuzz” if the number is divisible by 3 and 5, “Buzz” if divisible by “5”, “Fizz” if divisible by 3 and otherwise just output the number.</p>
<p>Here’s APL-FizzBuzz, as given in https://rosettacode.org/wiki/FizzBuzz#APL</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊃</span><span class="bp">⍵</span> <span class="s1">&#39;Fizz&#39;</span> <span class="s1">&#39;Buzz&#39;</span> <span class="s1">&#39;FizzBuzz&#39;</span><span class="sr">[</span><span class="nf">⎕IO</span><span class="o">++</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span><span class="o">×</span><span class="m">0</span><span class="o">=</span><span class="m">3</span> <span class="m">5</span><span class="o">|</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳</span><span class="m">16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────────────────────────────────────────────┐
│     ┌→───┐   ┌→───┐ ┌→───┐     ┌→───┐ ┌→───┐    ┌→───┐       ┌→───────┐    │
│ 1 2 │Fizz│ 4 │Buzz│ │Fizz│ 7 8 │Fizz│ │Buzz│ 11 │Fizz│ 13 14 │FizzBuzz│ 16 │
│     └────┘   └────┘ └────┘     └────┘ └────┘    └────┘       └────────┘    │
└∊───────────────────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>The indexing function <code class="docutils literal notranslate"><span class="pre">1++/1</span> <span class="pre">2×0=3</span> <span class="pre">5|⍵</span></code> generates 1 for numbers not divisible by either 3 or 5, 2 for divisible by 3, 3 for divisible by 5 and 4 for divisible by 3 and 5. So how does that work?</p>
<p>Consider it right to left:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="m">3</span> <span class="m">5</span><span class="o">|</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">10</span> <span class="m">11</span> <span class="m">15</span> <span class="c1">⍝ Return length 2 vector with remainder from div by 3 and 5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 0│ │2 1│ │0 0│ │
│ └~──┘ └~──┘ └~──┘ │
└∊──────────────────┘
</span></div></div>
</div>
<p>Next step is to pick out the zeros</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="m">0</span><span class="o">=</span> <span class="m">3</span> <span class="m">5</span><span class="o">|</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">10</span> <span class="m">11</span> <span class="m">15</span> <span class="c1">⍝ Return length 2 vector with remainder from div by 3 and 5, highlighing zeros</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │0 1│ │0 0│ │1 1│ │
│ └~──┘ └~──┘ └~──┘ │
└∊──────────────────┘
</span></div></div>
</div>
<p>…and multiply by 1 and 2 respectively:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="m">1</span> <span class="m">2</span><span class="o">×</span> <span class="m">0</span><span class="o">=</span> <span class="m">3</span> <span class="m">5</span><span class="o">|</span> <span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">10</span> <span class="m">11</span> <span class="m">15</span> <span class="c1">⍝ ...multiplied by 1 and 2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │0 2│ │0 0│ │1 2│ │
│ └~──┘ └~──┘ └~──┘ │
└∊──────────────────┘
</span></div></div>
</div>
<p>Now what remains is to sum that up, and add <code class="docutils literal notranslate"><span class="pre">⎕IO</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="nf">⎕IO</span><span class="o">++</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span><span class="o">×</span> <span class="m">0</span><span class="o">=</span> <span class="m">3</span> <span class="m">5</span><span class="o">|</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">¨</span><span class="m">10</span> <span class="m">11</span> <span class="m">15</span> <span class="c1">⍝ ...multiplied by 1 and 2, and summed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│3 1 4│
└~────┘
</span></div></div>
</div>
<p>We can now index into the vector containing our output text, after disclosing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊃</span><span class="bp">⍵</span> <span class="s1">&#39;Fizz&#39;</span> <span class="s1">&#39;Buzz&#39;</span> <span class="s1">&#39;FizzBuzz&#39;</span><span class="sr">[</span><span class="nf">⎕IO</span><span class="o">++</span><span class="na">/</span> <span class="m">1</span> <span class="m">2</span><span class="o">×</span> <span class="m">0</span><span class="o">=</span> <span class="m">3</span> <span class="m">5</span><span class="o">|</span> <span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span> <span class="na">¨</span> <span class="m">3</span> <span class="m">10</span> <span class="m">11</span> <span class="m">15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────┐
│ ┌→───┐ ┌→───┐    ┌→───────┐ │
│ │Fizz│ │Buzz│ 11 │FizzBuzz│ │
│ └────┘ └────┘    └────────┘ │
└∊────────────────────────────┘
</span></div></div>
</div>
<p>This version is iterative, as it uses each (<code class="docutils literal notranslate"><span class="pre">¨</span></code>). We can take a radically different approach to take advantage of APL’s array operators:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">FizzBuzz</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">nums</span><span class="kd">←</span><span class="o">⍳</span><span class="bp">⍵</span>
    <span class="nv">mat</span><span class="kd">←</span><span class="p">(</span><span class="o">⍱</span><span class="na">⌿</span><span class="o">⍪⊢</span><span class="p">)</span><span class="m">0</span><span class="o">=</span><span class="m">3</span> <span class="m">5</span><span class="na">∘.</span><span class="o">|</span><span class="nv">nums</span>  <span class="c1">⍝ Remainder matrix</span>
    <span class="nv">mat</span><span class="o">×</span><span class="na">@</span><span class="m">1</span><span class="na">⍨</span><span class="kd">←</span><span class="nv">nums</span>            <span class="c1">⍝ Multiply first row by the source numbers</span>
    <span class="nv">mat</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;Fizz&#39;</span><span class="p">)</span><span class="na">@</span><span class="o">⊢</span><span class="na">@</span><span class="m">2</span><span class="o">⊢</span><span class="nv">mat</span>   <span class="c1">⍝ Replace any 1s in second row by Fizz</span>
    <span class="nv">mat</span><span class="kd">←</span><span class="p">(</span><span class="o">⊂</span><span class="s1">&#39;Buzz&#39;</span><span class="p">)</span><span class="na">@</span><span class="o">⊢</span><span class="na">@</span><span class="m">3</span><span class="o">⊢</span><span class="nv">mat</span>   <span class="c1">⍝ Replace any 1s in third row by Buzz</span>
    <span class="m">0</span><span class="o">~</span><span class="na">⍨¨</span><span class="o">,</span><span class="na">⌿</span><span class="nv">mat</span>               <span class="c1">⍝ Merge downwards and remove any zeros</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">FizzBuzz</span> <span class="m">16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DOMAIN ERROR: Right operand: not Boolean
FizzBuzz[5] mat←(⊂&#39;Buzz&#39;)@⊢@3⊢mat   ⍝ Replace any 1s in third row by Buzz
                          ∧
</pre></div>
</div>
</div>
</div>
<div class="section" id="split-a-string-into-a-vector-of-a-single-char-and-a-number">
<h2>Split a string into a vector of a single char and a number<a class="headerlink" href="#split-a-string-into-a-vector-of-a-single-char-and-a-number" title="Permalink to this headline">¶</a></h2>
<p>E.g ‘X1234’ gives ‘X’ 1234 – via &#64;Adám on APLOrchard</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="p">(</span><span class="o">↑,</span><span class="na">∘</span><span class="o">⍎↓</span><span class="p">)</span><span class="s1">&#39;X1234&#39;</span> <span class="c1">⍝ Drop the first char, evaluate the rest, and catenate the first char.</span>
</pre></div>
</div>
</div>
</div>
<p>Of course, using ⍎ on unfiltered user input can be dangerous.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊃,</span><span class="na">∘</span><span class="o">⍎∩</span><span class="na">∘</span><span class="nf">⎕D</span><span class="p">)</span><span class="s1">&#39;X4234&#39;</span> <span class="c1">⍝ safer, but can throw an error.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 4234│
└+─────┘
</span></div></div>
</div>
<p>Here the <a class="reference external" href="http://help.dyalog.com/latest/#Language/System%20Functions/d.htm">⎕D</a> is a system variable specifying “digits”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
│0123456789│
└──────────┘
</span></div></div>
</div>
<p>The industrial strength version uses <a class="reference external" href="http://help.dyalog.com/latest/#Language/System%20Functions/vfi.htm">⎕VFI</a>, (Verify and Fix Input) to properly – and safely – parse the integer part.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="p">(</span><span class="o">↑,</span><span class="m">2</span><span class="o">⊃</span><span class="na">∘</span><span class="nf">⎕VFI</span><span class="o">↓</span><span class="p">)</span><span class="s1">&#39;X1234&#39;</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div></div>
</div>
<p>Verify and Fix Input, when used dyadically, can be used to split and convert strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊃</span><span class="s1">&#39;x&#39;</span><span class="nf">⎕VFI</span><span class="s1">&#39;19x29x21&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────┐
│19 29 21│
└~───────┘
</span></div></div>
</div>
<p>We can see how the first version is derived from a perhaps more obvious starting point:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="nv">a</span><span class="kd">←</span><span class="m">1</span><span class="o">↑</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="nv">b</span><span class="kd">←</span><span class="o">⍎</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="nv">a</span><span class="o">,</span><span class="nv">b</span><span class="kt">}</span> <span class="s1">&#39;X1234&#39;</span> <span class="c1">⍝ Take head, eval tail</span>

<span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⍎</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span> <span class="s1">&#39;X1234&#39;</span>         <span class="c1">⍝ substitute variables</span>
<span class="m">1</span> <span class="kt">{</span><span class="p">(</span><span class="bp">⍺</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⍎</span><span class="bp">⍺</span><span class="o">↓</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span> <span class="s1">&#39;X1234&#39;</span>       <span class="c1">⍝ break out 1</span>
<span class="m">1</span> <span class="p">((</span><span class="o">⊣↑⊢</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⍎⊣↓⊢</span><span class="p">))</span> <span class="s1">&#39;X1234&#39;</span>       <span class="c1">⍝ train</span>
<span class="m">1</span> <span class="p">((</span><span class="o">↑</span><span class="p">)</span><span class="o">,</span><span class="p">(</span><span class="o">⍎↓</span><span class="p">))</span> <span class="s1">&#39;X1234&#39;</span>           <span class="c1">⍝ simplify</span>
<span class="m">1</span> <span class="p">(</span><span class="o">↑,</span><span class="na">∘</span><span class="o">⍎↓</span><span class="p">)</span> <span class="s1">&#39;X1234&#39;</span>              <span class="c1">⍝ remove parens</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│X 1234│
└+─────┘
</span></div></div>
</div>
</div>
<div class="section" id="partition-a-vector-into-groups-of-equal-elements">
<h2>Partition a vector into groups of equal elements<a class="headerlink" href="#partition-a-vector-into-groups-of-equal-elements" title="Permalink to this headline">¶</a></h2>
<p>Good partition primer on <a class="reference external" href="https://aplwiki.com/wiki/Partition_representations">APLWiki</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">partition</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">⊂</span><span class="na">⍨</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">partition</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">2</span> <span class="m">1</span> <span class="m">4</span> <span class="m">4</span> <span class="m">4</span> <span class="m">4</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────┐
│ ┌→────────┐ ┌→──┐ ┌→┐ ┌→──────┐ ┌→──┐ ┌→──┐ │
│ │1 1 1 1 1│ │2 2│ │1│ │4 4 4 4│ │1 1│ │2 2│ │
│ └~────────┘ └~──┘ └~┘ └~──────┘ └~──┘ └~──┘ │
└∊────────────────────────────────────────────┘
</span></div></div>
</div>
<p>If we need the run lengths, we can just count them up:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">≢</span><span class="na">¨</span><span class="nv">partition</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">2</span> <span class="m">1</span> <span class="m">4</span> <span class="m">4</span> <span class="m">4</span> <span class="m">4</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│5 2 1 4 2 2│
└~──────────┘
</span></div></div>
</div>
</div>
<div class="section" id="match-brackets">
<h2>Match brackets<a class="headerlink" href="#match-brackets" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">+</span><span class="na">\</span><span class="m">1</span> <span class="m">¯1</span> <span class="m">0</span><span class="sr">[</span><span class="s1">&#39;()&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span> <span class="s1">&#39;((2×3)+4)&#39;</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
│1 2 2 2 2 1 1 1 0│
└~────────────────┘
</span></div></div>
</div>
<p>Nice! That snippet was supposedly penned by Ken himself.</p>
<p>https://forums.dyalog.com/viewtopic.php?f=30&amp;t=1616
https://www.jsoftware.com/papers/perlis78.htm</p>
<p>How does it work?</p>
<p>Well, the expression <code class="docutils literal notranslate"><span class="pre">'()'⍳⍵</span></code> creates a vector of the same length as the argument containing a 1 (or 0, depending on <code class="docutils literal notranslate"><span class="pre">⎕io</span></code>) if the corresponding character is a ‘(‘, 2 for ‘)’ and 3 (overflow) for everything else. We then map those values to 1, ¯1 and 0 respectively, and scan-sum over those.</p>
<p>Another way, slightly shorter, to achieve the same thing:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">+</span><span class="na">\</span><span class="o">-</span><span class="na">⌿</span><span class="s1">&#39;()&#39;</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span> <span class="s1">&#39;((2×3)+4)&#39;</span>  <span class="c1">⍝ Match brackets</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
│1 2 2 2 2 1 1 1 0│
└~────────────────┘
</span></div></div>
</div>
<p>This version builds a matrix where the two rows are binary masks showing the positions of the respective brackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;()&#39;</span><span class="na">∘.</span><span class="o">=</span><span class="s1">&#39;((2×3)+4)&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
↓1 1 0 0 0 0 0 0 0│
│0 0 0 0 0 1 0 0 1│
└~────────────────┘
</span></div></div>
</div>
<p>Next step is to subtract row 2 from row 1</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">-</span><span class="na">⌿</span><span class="s1">&#39;()&#39;</span><span class="na">∘.</span><span class="o">=</span><span class="s1">&#39;((2×3)+4)&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│1 1 0 0 0 ¯1 0 0 ¯1│
└~──────────────────┘
</span></div></div>
</div>
<p>and then scan-sum</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">+</span><span class="na">\</span><span class="o">-</span><span class="na">⌿</span><span class="s1">&#39;()&#39;</span><span class="na">∘.</span><span class="o">=</span><span class="s1">&#39;((2×3)+4)&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
│1 2 2 2 2 1 1 1 0│
└~────────────────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="stdlib">
<h1>Stdlib<a class="headerlink" href="#stdlib" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Zips -- remix is basically zip </span>
<span class="nv">Zip</span><span class="kd">←</span><span class="o">↓⍉↑</span>
<span class="nv">PythonZip</span><span class="kd">←</span><span class="o">↓</span><span class="na">∘</span><span class="o">⍉</span><span class="na">∘</span><span class="o">↑</span><span class="p">(</span><span class="o">⌊</span><span class="na">⌿</span><span class="o">≢</span><span class="na">¨</span><span class="p">)</span><span class="o">↑</span><span class="na">¨</span><span class="o">⊢</span>  <span class="c1">⍝ Python&#39;s behaviour is to only zip to shortest vector if unmatched</span>
<span class="nv">PythonZip2</span><span class="kd">←</span><span class="o">↓</span><span class="p">(</span><span class="o">⌊</span><span class="na">/</span><span class="o">≢</span><span class="na">¨</span><span class="p">)</span><span class="o">↑⍉</span><span class="na">∘</span><span class="o">↑</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">NotUnzip</span><span class="kd">←</span><span class="o">|</span><span class="na">∘</span><span class="o">⍳</span><span class="na">∘</span><span class="o">≢⊢</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌸</span><span class="o">⊢</span>                                    <span class="c1">⍝ 2 Unzip &#39;dyalog&#39; NB: Not really unzip as such</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Split</span><span class="kd">←</span><span class="o">≠⊆⊢</span>                                           <span class="c1">⍝ Split string on a char</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">MSplit</span><span class="kd">←</span><span class="p">(</span><span class="o">~∊</span><span class="na">⍨</span><span class="p">)</span><span class="o">⊆⊢</span>                                      <span class="c1">⍝ Multi-char split</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RegSplit</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⊢</span><span class="na">/¨</span><span class="nv">r</span><span class="p">)</span><span class="o">↓</span><span class="na">¨</span><span class="bp">⍵</span><span class="o">⊂</span><span class="na">⍨</span><span class="p">(</span><span class="o">⍳≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∊</span><span class="m">1</span><span class="o">+⊃</span><span class="na">¨</span><span class="nv">r</span><span class="kd">←</span><span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;|^&#39;</span><span class="p">)</span><span class="nf">⎕S</span> <span class="m">0</span> <span class="m">1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span>  <span class="c1">⍝ Split string on a pattern</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RegexGroups</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="nf">⎕S</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="m">1</span><span class="o">↓</span><span class="nv">Lengths</span><span class="o">↑</span><span class="na">¨</span><span class="nv">Offsets</span><span class="o">↓</span><span class="na">¨</span><span class="o">⊂</span><span class="nv">Block</span><span class="p">)</span><span class="kt">}</span> <span class="o">⊢</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ Return all capture groups as a vector</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Range</span><span class="kd">←</span><span class="o">⊣+</span><span class="na">∘</span><span class="o">⍳-</span><span class="na">⍨</span>                                        <span class="c1">⍝ start Range end, but see dfns.iotag instead</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Replace</span><span class="kd">←</span><span class="s1">&#39; &#39;</span><span class="na">@</span><span class="p">(</span><span class="o">=</span><span class="na">∘</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">⊢</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Foldl</span><span class="kd">←</span><span class="kt">{</span><span class="o">↑</span><span class="bp">⍺⍺</span><span class="na">⍨/</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,⊂</span><span class="bp">⍺</span><span class="kt">}</span>                                <span class="c1">⍝ 0 + Foldl 1 2 3 4 5 ⍝ Must give initial accumulator state</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Flatten</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃,</span><span class="na">/</span><span class="o">,⊆</span><span class="na">¨</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⍣</span><span class="o">≡</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Filter</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="bp">⍺⍺</span> <span class="bp">⍵</span><span class="kt">}</span>                                    <span class="c1">⍝ Simple list only: {⍵&lt;10} Filter 1 2 55 27 11 6 5 0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">FilterNested</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="bp">⍺⍺</span><span class="na">¨</span><span class="bp">⍵</span><span class="kt">}</span>                             
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pairs</span><span class="kd">←</span><span class="kt">{</span><span class="o">,⍳</span><span class="bp">⍵</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">OverlappingPairs</span><span class="kd">←</span><span class="kt">{{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">2</span> <span class="o">⊢</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Balance</span><span class="kd">←</span><span class="kt">{</span><span class="o">+</span><span class="na">\</span><span class="o">-</span><span class="na">⌿</span><span class="bp">⍺</span><span class="na">∘.</span><span class="o">=</span><span class="bp">⍵</span><span class="kt">}</span>                                 <span class="c1">⍝ &#39;()&#39; Balance &#39;(a+b+(1-c))&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Normalise</span><span class="kd">←</span><span class="o">⊢÷+</span><span class="na">/</span>                                      <span class="c1">⍝ Make vector components sum to 1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Divisors</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">=</span><span class="m">1</span><span class="bp">:</span><span class="o">,</span><span class="m">1</span><span class="p">⋄</span><span class="o">∊</span><span class="na">∘.</span><span class="o">×</span><span class="na">/</span><span class="kt">{</span><span class="bp">⍺</span><span class="na">∘.</span><span class="o">*</span><span class="m">0</span><span class="o">,⍳</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌿</span><span class="m">2</span> <span class="nv">dfns</span><span class="na">.</span><span class="nv">pco</span> <span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">DivisiorSum</span><span class="kd">←</span><span class="kt">{</span><span class="o">×</span><span class="na">/</span><span class="kt">{</span><span class="p">(</span><span class="m">¯1</span><span class="o">+</span><span class="bp">⍺</span><span class="o">*</span><span class="bp">⍵</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">÷</span><span class="bp">⍺</span><span class="o">-</span><span class="m">1</span><span class="kt">}</span><span class="na">⌿</span><span class="m">2</span> <span class="nv">dfns</span><span class="na">.</span><span class="nv">pco</span> <span class="bp">⍵</span><span class="kt">}</span>       <span class="c1">⍝ A.k.a sigma1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">SortByCol</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="sr">[</span><span class="o">⍋</span><span class="bp">⍵</span><span class="sr">[;</span><span class="bp">⍺</span><span class="sr">];]</span><span class="kt">}</span>                              <span class="c1">⍝ col SortByCol mat</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Convert</span><span class="kd">←</span><span class="kt">{</span><span class="m">6</span><span class="bp">::⍵</span><span class="p">⋄</span><span class="o">⍎</span><span class="bp">⍵</span><span class="kt">}</span>                                   <span class="c1">⍝ Note -- unsafe</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Cmb</span><span class="kd">←</span><span class="kt">{</span>                                               <span class="c1">⍝ Find all combinations of N numbers ∊⍳M that sum to M</span>
    <span class="p">(</span><span class="nv">num</span> <span class="nv">total</span><span class="p">)</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">A</span><span class="kd">←</span><span class="o">⊃</span><span class="na">∘.</span><span class="o">+</span><span class="na">/</span><span class="p">(</span><span class="nv">num</span><span class="o">-</span><span class="m">1</span><span class="p">)</span><span class="o">⍴⊂⍳</span><span class="nv">total</span>
    <span class="o">⊃,</span><span class="na">/</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="na">¨</span><span class="o">⍸</span><span class="p">(</span><span class="nv">total</span><span class="o">-</span><span class="bp">⍵</span><span class="p">)</span><span class="o">=</span><span class="nv">A</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳</span><span class="nv">total</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ConvToIdx</span><span class="kd">←</span><span class="o">∪⍳⊢</span>                                       <span class="c1">⍝ convert strings to IDs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ConvToDigits</span><span class="kd">←</span><span class="m">10</span><span class="na">∘</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span>                                <span class="c1">⍝ Split a number into a vector of digits</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">IsNumber</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=</span><span class="m">2</span><span class="o">|</span><span class="nf">⎕DR</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>                               <span class="c1">⍝ Are we numeric?</span>
<span class="nv">IsString</span><span class="kd">←</span><span class="o">⍕≡⊢</span>                                        <span class="c1">⍝ Are we a simple character vector?</span>
<span class="nv">IsNamespace</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">326</span><span class="o">=</span><span class="nf">⎕DR</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>                            <span class="c1">⍝ Are we a reference/object/namespace?</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Substring</span><span class="kd">←</span><span class="o">⍸⍷</span>                                        <span class="c1">⍝ &#39;ll&#39; (⍸⍷) &#39;hello&#39; ⍝ 3</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Del</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="m">0</span><span class="na">@</span><span class="bp">⍺</span><span class="o">⊢</span><span class="m">1</span><span class="na">⍨¨</span><span class="bp">⍵</span><span class="kt">}</span>                                   <span class="c1">⍝ 2 5 Del ⍳10 ⍝ remove indices ⍺ from array ⍵</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Group</span><span class="kd">←</span><span class="o">↓⊃</span><span class="na">¨</span><span class="o">,</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌸</span><span class="o">⊢</span><span class="na">/¨</span>                                    <span class="c1">⍝ Group vector elements based on first</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">GroupSplit</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">⊆</span><span class="na">⍨</span><span class="o">×≢</span><span class="na">¨</span><span class="bp">⍵</span><span class="kt">}</span>                                <span class="c1">⍝ Group vector elements separated by empty</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">BinaryCombos</span><span class="kd">←</span><span class="kt">{</span><span class="o">⍉</span><span class="p">(</span><span class="bp">⍵</span><span class="o">⍴</span><span class="m">2</span><span class="p">)</span><span class="o">⊤⍳</span><span class="m">2</span><span class="o">*</span><span class="bp">⍵</span><span class="kt">}</span>                          <span class="c1">⍝ All binary combinations of ⍵ bits</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ExtractNumbers</span><span class="kd">←</span><span class="o">⍎</span><span class="na">¨</span><span class="o">∊</span><span class="na">∘</span><span class="nf">⎕d</span><span class="o">⊆⊢</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="error-handling">
<h2>Error handling<a class="headerlink" href="#error-handling" title="Permalink to this headline">¶</a></h2>
<p>Using error guards</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span> <span class="kt">{</span><span class="m">3</span><span class="bp">::</span><span class="s1">&#39;out of bounds&#39;</span> <span class="p">⋄</span> <span class="bp">⍺</span> <span class="o">⌷</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
4

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">8</span> <span class="kt">{</span><span class="m">3</span><span class="bp">::</span><span class="s1">&#39;out of bounds&#39;</span> <span class="p">⋄</span> <span class="bp">⍺</span> <span class="o">⌷</span> <span class="bp">⍵</span><span class="kt">}</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────┐
│out of bounds│
└─────────────┘
</span></div></div>
</div>
<p>Note that the body of an error guard is evaluated <em>after</em> the local envioronment is unwound. This is likely not what you expect if you come from say Python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">F1</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Can you spot the bug?</span>
    <span class="m">11</span><span class="bp">::</span><span class="nv">nums</span>
    <span class="nv">nums</span><span class="kd">←</span><span class="m">1</span> <span class="bp">⍺</span>
    <span class="nv">nums</span><span class="o">×÷</span><span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">F2</span><span class="kd">←</span><span class="kt">{</span>
    <span class="nv">nums</span><span class="kd">←</span><span class="m">1</span> <span class="bp">⍺</span>
    <span class="m">0</span><span class="o">=</span><span class="bp">⍵:</span><span class="nv">nums</span>
    <span class="nv">nums</span><span class="o">×÷</span><span class="bp">⍵</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span> <span class="nv">F2</span> <span class="m">0</span> <span class="c1">⍝ The expected behaviour</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
│1 4│
└~──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">4</span> <span class="nv">F1</span> <span class="m">0</span> <span class="c1">⍝ Throws a perhaps unexpected VALUE ERROR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────────┐
│1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16│
└~─────────────────────────────────────┘
</span></div></div>
</div>
<p>Further, the mere presence of an error guard <em>disables tail call optimisation</em>.</p>
</div>
<div class="section" id="sets">
<h2>Sets<a class="headerlink" href="#sets" title="Permalink to this headline">¶</a></h2>
<p>Set XOR - union minus intersection, using a train</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="p">(</span><span class="o">∪~∩</span><span class="p">)</span><span class="na">/</span> <span class="p">(</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span><span class="p">)</span> <span class="p">(</span><span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span><span class="p">)</span> <span class="c1">⍝ Elements in ⍺ or ⍵ but not in both</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│1 2 3 7 8│
└~────────┘
</span></div></div>
</div>
</div>
<div class="section" id="encode-and-decode">
<h2>Encode and decode ⊤ ⊥<a class="headerlink" href="#encode-and-decode" title="Permalink to this headline">¶</a></h2>
<p>Encode and decode converts between decimal and some encoding vector.</p>
<p>Split a number into digits and pad with zeros from the left:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">10</span> <span class="m">10</span> <span class="m">10</span> <span class="m">10</span> <span class="m">10</span> <span class="o">⊤</span> <span class="m">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│0 0 0 1 2│
└~────────┘
</span></div></div>
</div>
<p>Convert from seconds to H M S:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="m">24</span> <span class="m">60</span> <span class="m">60</span> <span class="o">⊤</span> <span class="m">8473</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│0 2 21 13│
└~────────┘
</span></div></div>
</div>
<p>Decode goes the other way</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="m">24</span> <span class="m">60</span> <span class="m">60</span> <span class="o">⊥</span> <span class="m">0</span> <span class="m">2</span> <span class="m">21</span> <span class="m">13</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">    
8473

</span></div></div>
</div>
<p>Sometimes swapped to save some brackets</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">12</span> <span class="o">⊤</span><span class="na">⍨</span> <span class="m">5</span><span class="o">⍴</span><span class="m">10</span> <span class="c1">⍝ instead of (5⍴10) ⊤ 12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│0 0 0 1 2│
└~────────┘
</span></div></div>
</div>
<p>We can exploit decode to sum elements of a vector, which faster than the normal +/ approach and a useful trick in trains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="o">⊥</span><span class="m">1</span> <span class="m">3</span> <span class="m">2</span> <span class="m">5</span> <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
17

</span></div></div>
</div>
</div>
</div>
<div class="section" id="trains">
<h1>Trains<a class="headerlink" href="#trains" title="Permalink to this headline">¶</a></h1>
<p>Trains are APL’s functional composition mechanism.</p>
<p>Here are the rules for 2 and 3-carriage trains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">F</span> <span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">F</span> <span class="n">x</span><span class="p">)</span> <span class="n">G</span> <span class="p">(</span><span class="n">H</span> <span class="n">x</span><span class="p">)</span>
<span class="p">(</span><span class="n">u</span> <span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">u</span> <span class="n">G</span> <span class="p">(</span><span class="n">H</span> <span class="n">x</span><span class="p">)</span>
<span class="p">(</span><span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">x</span> <span class="o">-&gt;</span> <span class="n">G</span> <span class="p">(</span><span class="n">H</span> <span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="p">(</span><span class="n">F</span> <span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="n">x</span> <span class="n">F</span> <span class="n">y</span><span class="p">)</span> <span class="n">G</span> <span class="p">(</span><span class="n">x</span> <span class="n">H</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="p">(</span><span class="n">u</span> <span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">u</span> <span class="n">G</span> <span class="p">(</span><span class="n">x</span> <span class="n">H</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span> <span class="p">(</span><span class="n">G</span> <span class="n">H</span><span class="p">)</span> <span class="n">y</span> <span class="o">-&gt;</span> <span class="n">G</span> <span class="p">(</span><span class="n">x</span> <span class="n">H</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Construct a vector of the sum and product of two numbers</span>
<span class="m">2</span> <span class="p">(</span><span class="o">+,×</span><span class="p">)</span> <span class="m">5</span>  <span class="c1">⍝ x (F G H) y -&gt; (x F y) G (x H y)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───┐
│7 10│
└~───┘
</span></div></div>
</div>
<p>This is a three-function train, consisting of sum, catenate, product. For a three-function train (LMR) in the dyadic case, the execution flow is (⍺ L ⍵) M (⍺ R ⍵) or specifically (2+5),(2×5).</p>
<p>Here’s another example: split a string on a separator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;,&#39;</span> <span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span> <span class="s1">&#39;one,two,three&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→────┐ │
│ │one│ │two│ │three│ │
│ └───┘ └───┘ └─────┘ │
└∊────────────────────┘
</span></div></div>
</div>
<p>Given the execution flow above we have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lhs</span> <span class="kd">←</span> <span class="s1">&#39;,&#39;</span><span class="o">≠</span><span class="s1">&#39;one,two,three&#39;</span>  <span class="c1">⍝ Binary match vector</span>
<span class="nv">Rhs</span> <span class="kd">←</span> <span class="s1">&#39;,&#39;</span><span class="o">⊢</span><span class="s1">&#39;one,two,three&#39;</span>  <span class="c1">⍝ Just return the right-hand argument</span>
<span class="nv">Lhs</span> <span class="o">⊆</span> <span class="nv">Rhs</span>                  <span class="c1">⍝ Partition based on binary match vector</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→────┐ │
│ │one│ │two│ │three│ │
│ └───┘ └───┘ └─────┘ │
└∊────────────────────┘
</span></div></div>
</div>
<p>The right-tack ⊢ is used in trains as an identity function to force the correct monadic/dyadic behaviour.</p>
<p>Another canonical example is calculating the mean with a three-function monadic train:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">+</span><span class="na">/</span><span class="o">÷≢</span><span class="p">)</span> <span class="m">3</span> <span class="m">6</span> <span class="m">4</span> <span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   
5.5

</span></div></div>
</div>
<p>This translates to:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lhs</span> <span class="kd">←</span> <span class="o">+</span><span class="na">/</span> <span class="m">3</span> <span class="m">6</span> <span class="m">4</span> <span class="m">9</span>   <span class="c1">⍝ Sum </span>
<span class="nv">Rhs</span> <span class="kd">←</span> <span class="o">≢</span> <span class="m">3</span> <span class="m">6</span> <span class="m">4</span> <span class="m">9</span>    <span class="c1">⍝ Count</span>
<span class="nv">Lhs</span> <span class="o">÷</span> <span class="nv">Rhs</span>          <span class="c1">⍝ Mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">   
5.5

</span></div></div>
</div>
<p>Set XOR using a union-not-intersect train</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="p">(</span><span class="o">∪~∩</span><span class="p">)</span><span class="na">/</span> <span class="p">(</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span><span class="p">)</span> <span class="p">(</span><span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│1 2 3 7 8│
└~────────┘
</span></div></div>
</div>
<p>Here’s a longer example: generate an integer range</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">+</span><span class="m">5</span> <span class="p">(</span><span class="o">⊣+</span><span class="na">∘</span><span class="o">⍳-</span><span class="na">⍨</span><span class="p">)</span> <span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│5 6 7 8 9│
└~────────┘
</span></div></div>
</div>
<p>and an even longer, splitting a vector in n parts by unzipping:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span> <span class="p">(</span><span class="o">|</span><span class="na">∘</span><span class="o">⍳</span><span class="na">∘</span><span class="o">≢⊢</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌸</span><span class="o">⊢</span><span class="p">)</span> <span class="s1">&#39;dyaloge&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────┐
│ ┌→───┐ ┌→──┐ │
│ │daoe│ │ylg│ │
│ └────┘ └───┘ │
└∊─────────────┘
</span></div></div>
</div>
<p>The following tactit groups pairs based on the first component of each pair:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">m</span><span class="kd">←</span><span class="p">(</span><span class="m">5</span> <span class="m">3</span><span class="p">)(</span><span class="m">5</span> <span class="m">6</span><span class="p">)(</span><span class="m">7</span> <span class="m">5</span><span class="p">)(</span><span class="m">4</span> <span class="m">7</span><span class="p">)(</span><span class="m">1</span> <span class="m">8</span><span class="p">)(</span><span class="m">2</span> <span class="m">4</span><span class="p">)(</span><span class="m">1</span> <span class="m">2</span><span class="p">)</span>
<span class="p">(</span><span class="o">↓⊃</span><span class="na">¨</span><span class="o">,</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌸</span><span class="o">⊢</span><span class="na">/¨</span><span class="p">)</span><span class="nv">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→────────┐ ┌→──────┐ ┌→──────┐ ┌→────────┐ ┌→──────┐ │
│ │   ┌→──┐ │ │   ┌→┐ │ │   ┌→┐ │ │   ┌→──┐ │ │   ┌→┐ │ │
│ │ 5 │3 6│ │ │ 7 │5│ │ │ 4 │7│ │ │ 1 │8 2│ │ │ 2 │4│ │ │
│ │   └~──┘ │ │   └~┘ │ │   └~┘ │ │   └~──┘ │ │   └~┘ │ │
│ └∊────────┘ └∊──────┘ └∊──────┘ └∊────────┘ └∊──────┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Let’s unwind that one in steps. Step 1: separate the tacit expression into individual functions, taking into account operators:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(↓) (⊃¨) (,∘⊂⌸) (⊢/¨)
</pre></div>
</div>
<p>Step 2: convert to dfn by considering first any 3-trains from the right:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{ (⊃¯⍵) (,∘⊂⌸) ⊢/¨⍵ }
</pre></div>
</div>
<p>The middle bit is idiomatic use of key that can also be written as <code class="docutils literal notranslate"><span class="pre">{⍺⍵}⌸</span></code>. So we’re looking at a left argument which is simply a vector of all first components of the pairs, and a right argument which is the last component of every pair, applied to the dyadic key, which groups the right arg based on the unique elements in the left.</p>
<p>Step 3: as we’ve only a remaining <code class="docutils literal notranslate"><span class="pre">↓</span></code>, it’s simply applied to the result.</p>
</div>
<div class="section" id="tack-tricks">
<h1>Tack tricks<a class="headerlink" href="#tack-tricks" title="Permalink to this headline">¶</a></h1>
<p>Left (⊣) and right (⊢) tacks return the argument they point to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Left&#39;</span><span class="o">⊣</span><span class="s1">&#39;Right&#39;</span> <span class="p">⋄</span> <span class="s1">&#39;Left&#39;</span><span class="o">⊢</span><span class="s1">&#39;Right&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───┐
│Left│
└────┘
┌→────┐
│Right│
└─────┘
</span></div></div>
</div>
<p>We saw earlier their place in trains to refer to left or right arguments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;,&#39;</span> <span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span> <span class="s1">&#39;one,two,three&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→────┐ │
│ │one│ │two│ │three│ │
│ └───┘ └───┘ └─────┘ │
└∊────────────────────┘
</span></div></div>
</div>
<p>Another use is when we want to return a value after first mutating it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mem</span> <span class="kd">←</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>
<span class="nv">mem</span> <span class="o">⊣</span> <span class="nv">mem</span><span class="sr">[</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span> <span class="kd">←</span> <span class="m">10</span> <span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│10 10 3 4 5│
└~──────────┘
</span></div></div>
</div>
<p>We can also use tacks to pick the first or last column of a matrix. This is a Dyalog <a class="reference external" href="https://help.dyalog.com/17.1/#Language/Defined%20Functions%20and%20Operators/Idiom%20Recognition/Idiom%20List.htm">idiom</a>
meaning it’s highly optimised.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">m</span><span class="kd">←</span><span class="m">2</span> <span class="m">3</span><span class="o">⍴</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span> <span class="m">9</span>
<span class="vg">⎕</span><span class="kd">←</span><span class="nv">first</span><span class="kd">←</span><span class="o">⊣</span><span class="na">/</span><span class="nv">m</span>
<span class="vg">⎕</span><span class="kd">←</span><span class="nv">last</span><span class="kd">←</span><span class="o">⊢</span><span class="na">/</span><span class="nv">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
↓1 2 3│
│4 5 6│
└~────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
│1 4│
└~──┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
│3 6│
└~──┘
</span></div></div>
</div>
</div>
<div class="section" id="indexing">
<h1>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h1>
<p>There are several ways of indexing into arrays and vectors. Crucially, elements of vectors and matrices are always scalars, but a scalar can be a boxed-up vector or matrix.</p>
<p>Indexing with [] or ⌷ returns the box, not the element, although if the element is a simple scalar, it’s the same thing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="kd">←</span><span class="o">⍳</span><span class="m">10</span>
<span class="nv">v</span><span class="sr">[</span><span class="m">5</span><span class="sr">]</span>
<span class="nv">v</span><span class="sr">[</span><span class="m">5</span> <span class="m">2</span><span class="sr">]</span>
<span class="m">3</span><span class="o">⌷</span><span class="nv">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
5

</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
│5 2│
└~──┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
3

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="kd">←</span><span class="p">(</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span><span class="p">)(</span><span class="m">4</span> <span class="m">5</span> <span class="m">6</span><span class="p">)(</span><span class="m">7</span> <span class="m">8</span> <span class="m">9</span><span class="p">)</span>
<span class="nv">v</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span>  <span class="c1">⍝ Return the box at element 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────┐
│ ┌→────┐ │
│ │1 2 3│ │
│ └~────┘ │
└∊────────┘
</span></div></div>
</div>
<p>To get to the boxed element, we need to either disclose, or pick:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="nv">v</span><span class="sr">[</span><span class="m">1</span><span class="sr">]</span>  <span class="c1">⍝ Open box (disclose)</span>
<span class="m">1</span><span class="o">⊃</span><span class="nv">v</span>    <span class="c1">⍝ Pick element at 1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│1 2 3│
└~────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│1 2 3│
└~────┘
</span></div></div>
</div>
<p>The same box-unbox rules also apply to mutation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="kd">←</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="c1">⍝ Will fail with LENGTH ERROR, as value isn&#39;t boxed.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LENGTH ERROR
      v[2]←1 2 3 ⍝ Will fail with LENGTH ERROR, as value isn&#39;t boxed.
          ∧
</pre></div>
</div>
</div>
</div>
<p>Instead we need to explicitly enclose the new vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="kd">←</span><span class="o">⊂</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span>
<span class="nv">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
│ ┌→────┐ ┌→────┐ ┌→────┐ │
│ │1 2 3│ │1 2 3│ │7 8 9│ │
│ └~────┘ └~────┘ └~────┘ │
└∊────────────────────────┘
</span></div></div>
</div>
<div class="section" id="set-values-with">
<h2>Set values with &#64;<a class="headerlink" href="#set-values-with" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator is very powerful and can be applied in several ways. In the simples case, we can give a list of values and a list of indexes where to set them. This creates a new copy of the right argument, with the new values.</p>
<p>See https://stackoverflow.com/questions/64259704/apl-arrays-element-replacement-and-multiplication</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">9</span> <span class="m">9</span> <span class="na">@</span> <span class="m">3</span> <span class="m">4</span> <span class="o">⊢</span> <span class="nv">vec</span><span class="kd">←</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span>             <span class="c1">⍝ Note -- no mutation</span>
<span class="nv">vec</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────┐
│1 2 9 9 5 6 7 8│
└~──────────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────┐
│1 2 3 4 5 6 7 8│
└~──────────────┘
</span></div></div>
</div>
<p>Contrast this to direct assignment, which mutates in place:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vec</span> <span class="o">⊣</span> <span class="nv">vec</span><span class="sr">[</span><span class="m">4</span> <span class="m">5</span><span class="sr">]</span> <span class="kd">←</span> <span class="m">8</span> <span class="m">8</span>          <span class="c1">⍝ Note -- direct assignment mutates v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────┐
│1 2 3 8 8 6 7 8│
└~──────────────┘
</span></div></div>
</div>
<p>The &#64; operator can also apply functions which modify the values in several different ways. The monadic case</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="na">@</span><span class="m">2</span> <span class="m">5</span><span class="p">)</span><span class="m">10</span> <span class="m">20</span> <span class="m">30</span> <span class="m">40</span> <span class="m">50</span> <span class="m">60</span>  <span class="c1">⍝ Apply monadic - at positions 2 and 5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│10 ¯20 30 40 ¯50 60│
└~──────────────────┘
</span></div></div>
</div>
<p>Similarly, we can apply dyads:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">7</span><span class="p">(</span><span class="o">+</span><span class="na">@</span><span class="m">2</span> <span class="m">5</span><span class="p">)</span><span class="m">10</span> <span class="m">20</span> <span class="m">30</span> <span class="m">40</span> <span class="m">50</span> <span class="m">60</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
│10 27 30 40 57 60│
└~────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;x&#39;</span><span class="na">@</span><span class="p">(</span><span class="o">∊</span><span class="na">∘</span><span class="nf">⎕A</span><span class="p">)</span><span class="s1">&#39;Hello World&#39;</span> <span class="c1">⍝ Replace all uppercase letters with &#39;x&#39;. ⎕A gives the uppercase letters.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│xello xorld│
└───────────┘
</span></div></div>
</div>
<p>We can also apply <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> with a function that returns a binary vector when applied to the right argument of the derived function, e.g:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;*&#39;</span><span class="na">@</span><span class="p">(</span><span class="m">2</span><span class="na">∘</span><span class="o">|</span><span class="p">)</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>     <span class="c1">⍝ Replace odds with &#39;*&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│* 2 * 4 *│
└+────────┘
</span></div></div>
</div>
<p>or as simple as</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;*&#39;</span><span class="na">@</span><span class="kt">{</span><span class="m">1</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span><span class="kt">}</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│* 2 * 4 *│
└+────────┘
</span></div></div>
</div>
<p>For a more involved example, let’s write an expression that given a vector of values and a vector of row indices appends values to a column in the argument matrix:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">mat</span><span class="kd">←</span><span class="o">↑</span><span class="kt">{</span><span class="p">(</span><span class="bp">⍵</span> <span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="m">3</span><span class="o">+⍳</span><span class="m">5</span>  <span class="c1">⍝ Start state: a 5x2 matrix, columns are vectors</span>
<span class="nv">vals</span><span class="kd">←</span><span class="o">⍳</span><span class="m">5</span>                <span class="c1">⍝ Values to append to the first column</span>
<span class="nv">rows</span><span class="kd">←</span><span class="o">?</span><span class="na">⍨</span><span class="m">5</span>               <span class="c1">⍝ ...of these rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">,</span><span class="na">¨∘</span><span class="nv">vals</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="nv">rows</span><span class="o">,</span><span class="na">¨</span><span class="m">1</span><span class="p">)</span><span class="o">⊢</span><span class="nv">mat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────┐
↓ ┌→────┐ ┌→──┐ │
│ │4 1 2│ │0 0│ │
│ └~────┘ └~──┘ │
│ ┌→────┐ ┌→──┐ │
│ │5 1 3│ │0 0│ │
│ └~────┘ └~──┘ │
│ ┌→────┐ ┌→──┐ │
│ │6 1 4│ │0 0│ │
│ └~────┘ └~──┘ │
│ ┌→────┐ ┌→──┐ │
│ │7 1 1│ │0 0│ │
│ └~────┘ └~──┘ │
│ ┌→────┐ ┌→──┐ │
│ │8 1 5│ │0 0│ │
│ └~────┘ └~──┘ │
└∊──────────────┘
</span></div></div>
</div>
<p>How does this work? The right arg of <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> fleshes out the list of row indices to include the column we target:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">rows</span>
<span class="nv">rows</span><span class="o">,</span><span class="na">¨</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│4 1 2 3 5│
└~────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │4 1│ │1 1│ │2 1│ │3 1│ │5 1│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊──────────────────────────────┘
</span></div></div>
</div>
<p>This gives us a complete set of row-col pairs. Let’s look at the tacit left argument. It’s parsed like so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   ∘               
  ┌┴┐              
  ¨ vals
┌─┘                
,                  
</pre></div>
</div>
<p>which is just <code class="docutils literal notranslate"><span class="pre">{⍵,¨vals}</span></code> as an explicit dfn.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍵</span><span class="o">,</span><span class="na">¨</span><span class="nv">vals</span><span class="kt">}</span> <span class="nv">mat</span><span class="sr">[</span><span class="nv">rows</span><span class="o">,</span><span class="na">¨</span><span class="m">1</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────┐
│ ┌→────┐ ┌→────┐ ┌→────┐ ┌→────┐ ┌→────┐ │
│ │7 1 1│ │4 1 2│ │5 1 3│ │6 1 4│ │8 1 5│ │
│ └~────┘ └~────┘ └~────┘ └~────┘ └~────┘ │
└∊────────────────────────────────────────┘
</span></div></div>
</div>
<p>Finally, <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> inserts everything back.</p>
<p>Let’s look at some types of ‘search &amp; replace’. Given an array, some specific values and corresponding replacement values</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">array</span><span class="kd">←</span><span class="o">?</span><span class="m">10</span> <span class="m">3</span><span class="o">⍴</span><span class="m">10</span>
<span class="nv">specific</span><span class="kd">←</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span>
<span class="nv">replacements</span><span class="kd">←</span><span class="m">0</span> <span class="m">10</span> <span class="m">100</span> <span class="m">1000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="nv">replacements</span><span class="sr">[</span><span class="nv">specific</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span><span class="na">@</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">∊</span><span class="nv">specific</span><span class="kt">}</span> <span class="nv">array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
↓ 5  100 10│
│10   10 10│
│ 5    9  8│
│10 1000 10│
│10    6  8│
│10   10  0│
│10    9 10│
│10    9  9│
│10    0  6│
│ 6    9 10│
└~─────────┘
</span></div></div>
</div>
<p>So this is the <code class="docutils literal notranslate"><span class="pre">(f&#64;g)Y</span></code> form of <code class="docutils literal notranslate"><span class="pre">&#64;</span></code>. See all forms in <a class="reference external" href="https://aplcart.info/?q=%40%20primitive">APLCart</a>. The right-hand function should return a binary map indicating which positions in the argument array are to be changed. The left-hand function is given each corresponding value as <code class="docutils literal notranslate"><span class="pre">⍵</span></code>, and should return the new value.</p>
<p>An alternative formulation mirroring the way that <code class="docutils literal notranslate"><span class="pre">⎕R</span></code> works is:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Repl</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺⍺</span><span class="p">(</span><span class="bp">⍵⍵</span><span class="o">⌷</span><span class="na">⍨∘</span><span class="o">⊂⍳</span><span class="p">)</span><span class="na">@</span><span class="p">(</span><span class="o">∊</span><span class="na">∘</span><span class="bp">⍺⍺</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">specific</span> <span class="nv">Repl</span> <span class="nv">replacements</span> <span class="o">⊢</span> <span class="nv">array</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
↓ 5  100 10│
│10   10 10│
│ 5    9  8│
│10 1000 10│
│10    6  8│
│10   10  0│
│10    9 10│
│10    9  9│
│10    0  6│
│ 6    9 10│
└~─────────┘
</span></div></div>
</div>
<p>See https://aplcart.info/?q=search-and-replace#</p>
<p>We can pick columns any number of ways:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">mat</span><span class="kd">←</span><span class="m">3</span> <span class="m">4</span><span class="o">⍴?⍳</span><span class="m">12</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────┐
↓1 2 2  2│
│3 4 6  2│
│3 6 7 10│
└~───────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">↑</span><span class="na">⍤</span><span class="m">1</span><span class="o">⊢</span><span class="nv">mat</span>        <span class="c1">⍝ Two first, as proper columns</span>
<span class="nv">mat</span><span class="sr">[;</span><span class="m">1</span> <span class="m">2</span><span class="sr">]</span>       <span class="c1">⍝ Brackets, as proper columns</span>
<span class="p">(</span><span class="o">⊂</span><span class="m">1</span> <span class="m">2</span><span class="p">)</span><span class="o">⌷</span><span class="sr">[</span><span class="m">2</span><span class="sr">]</span><span class="nv">mat</span>   <span class="c1">⍝ Using squad ⌷, somewhat clumsily</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓1 2│
│3 4│
│3 6│
└~──┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓1 2│
│3 4│
│3 6│
└~──┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓1 2│
│3 4│
│3 6│
└~──┘
</span></div></div>
</div>
<p>First location of element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">keys</span><span class="kd">←</span><span class="p">(</span><span class="m">0</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">3</span> <span class="m">2</span><span class="p">)</span>
<span class="nv">keys</span> <span class="o">⍳</span> <span class="p">(</span><span class="o">⊂</span><span class="m">0</span> <span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
2

</span></div></div>
</div>
<p>Bind argument to a lookup function for an immutable “hash table”:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">find</span><span class="kd">←</span><span class="nv">keys</span><span class="na">∘</span><span class="o">⍳</span>
<span class="nv">find</span> <span class="o">⊂</span><span class="m">0</span> <span class="m">9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
4

</span></div></div>
</div>
</div>
</div>
<div class="section" id="products">
<h1>Products<a class="headerlink" href="#products" title="Permalink to this headline">¶</a></h1>
<p>Cartesian product</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">pairs</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">,</span><span class="p">(</span><span class="o">⍳</span><span class="bp">⍵</span><span class="p">)</span><span class="na">∘.</span><span class="o">,⍳</span><span class="bp">⍵</span><span class="kt">}</span>  <span class="c1">⍝ Python [[x, y] for x in range(1,n+1) for y in range(1,n+1)]</span>
<span class="nv">pairs</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 1│ │1 2│ │1 3│ │2 1│ │2 2│ │2 3│ │3 1│ │3 2│ │3 3│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>or an alternative formulation, using iota. Think of the arguments to iota as defining the shape of the result:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">pairs</span> <span class="kd">←</span> <span class="kt">{</span><span class="o">,⍳</span><span class="bp">⍵</span> <span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">pairs</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 1│ │1 2│ │1 3│ │2 1│ │2 2│ │2 3│ │3 1│ │3 2│ │3 3│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>To pair the elements of two equal-length vectors, we can do:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span><span class="o">,</span><span class="na">¨</span><span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 5│ │2 6│ │3 7│ │4 8│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊────────────────────────┘
</span></div></div>
</div>
<p>or</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↓⍉↑</span><span class="p">(</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span><span class="p">)(</span><span class="m">5</span> <span class="m">6</span> <span class="m">7</span> <span class="m">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 5│ │2 6│ │3 7│ │4 8│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊────────────────────────┘
</span></div></div>
</div>
<p>Primes between 1 and 100, but see fast prime sieve <code class="docutils literal notranslate"><span class="pre">pco</span></code> in <code class="docutils literal notranslate"><span class="pre">dfns</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">~</span><span class="nv">R</span><span class="o">∊</span><span class="nv">R</span><span class="na">∘.</span><span class="o">×</span><span class="nv">R</span><span class="p">)</span><span class="na">/</span><span class="nv">R</span><span class="kd">←</span><span class="m">1</span><span class="o">↓⍳</span><span class="m">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────────────────────────────────────────┐
│2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97│
└~─────────────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="composition-currying">
<h1>Composition (Currying)<a class="headerlink" href="#composition-currying" title="Permalink to this headline">¶</a></h1>
<p>We can curry a dyadic function down to a monadic function by fixing either left or right argument:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">sum</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">+</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">add5</span><span class="kd">←</span><span class="m">5</span><span class="na">∘</span><span class="nv">sum</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add5</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
12

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">add5</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">6</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────┐
│6 7 8 9 10 11 12│
└~───────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="shape-and-rank">
<h1>Shape and Rank<a class="headerlink" href="#shape-and-rank" title="Permalink to this headline">¶</a></h1>
<p>Pair consecutive elements in a vector</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="p">(</span><span class="o">⍪</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span> <span class="o">⊢</span> <span class="o">⍳</span><span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→───┐ │
│ │1 2│ │3 4│ │5 6│ │7 8│ │9 10│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~───┘ │
└∊───────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,</span><span class="na">⌿</span><span class="o">⍉</span><span class="m">5</span> <span class="m">2</span> <span class="o">⍴</span> <span class="o">⍳</span><span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→───┐ │
│ │1 2│ │3 4│ │5 6│ │7 8│ │9 10│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~───┘ │
└∊───────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">↓</span><span class="m">5</span> <span class="m">2</span> <span class="o">⍴</span> <span class="o">⍳</span><span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→───┐ │
│ │1 2│ │3 4│ │5 6│ │7 8│ │9 10│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~───┘ │
└∊───────────────────────────────┘
</span></div></div>
</div>
<p>Overlapping pairs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">2</span> <span class="o">⊢</span> <span class="o">⍳</span><span class="m">10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→───┐ │
│ │1 2│ │2 3│ │3 4│ │4 5│ │5 6│ │6 7│ │7 8│ │8 9│ │9 10│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~───┘ │
└∊───────────────────────────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="folds">
<h1>Folds<a class="headerlink" href="#folds" title="Permalink to this headline">¶</a></h1>
<p>The reduce operator / folds R-L. It’s possible to define a fold operator that works L-R. All this does is to prepend the accumulator, and reverse the array we’re folding before applying the normal fold.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">foldl</span><span class="kd">←</span><span class="kt">{</span><span class="o">↑</span><span class="bp">⍺⍺</span><span class="na">⍨/</span><span class="p">(</span><span class="o">⌽</span><span class="bp">⍵</span><span class="p">)</span><span class="o">,⊂</span><span class="bp">⍺</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="o">+</span> <span class="nv">foldl</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="c1">⍝ Must give initial accumulator state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
15

</span></div></div>
</div>
<p>Note that this operator (and many others) exists in the standard Dyalog workspace <a class="reference external" href="https://dfns.dyalog.com/s_foldl.htm">dfns</a>, which can be imported as ⎕CY ‘dfns’</p>
</div>
<div class="section" id="on-ranges">
<h1>On ranges<a class="headerlink" href="#on-ranges" title="Permalink to this headline">¶</a></h1>
<p>In Python, for example, you can specify a <a class="reference external" href="https://docs.python.org/3/library/functions.html#func-range">range</a> as <code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">end)</span></code> which gives an iterator from start to end-1. In Dyalog there isn’t a direct equivalent, but one can be made from the iota operator.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">+</span><span class="m">5</span> <span class="kt">{</span><span class="bp">⍺</span><span class="o">↓⍳</span><span class="bp">⍵</span><span class="kt">}</span> <span class="m">10</span>   <span class="c1">⍝ Wasteful, as generating from ⎕IO</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│5 6 7 8 9│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">+</span><span class="m">5</span> <span class="p">(</span><span class="o">⊣↓</span><span class="na">∘</span><span class="o">⍳</span><span class="p">)</span> <span class="m">10</span>   <span class="c1">⍝ The abobve as a train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│5 6 7 8 9│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">+</span><span class="m">5</span> <span class="kt">{</span><span class="bp">⍺</span><span class="o">+⍳</span><span class="bp">⍵</span><span class="o">-</span><span class="bp">⍺</span><span class="kt">}</span> <span class="m">10</span> <span class="c1">⍝ Better!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│5 6 7 8 9│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">¯1</span><span class="o">+</span><span class="m">5</span> <span class="p">(</span><span class="o">⊣+</span><span class="na">∘</span><span class="o">⍳-</span><span class="na">⍨</span><span class="p">)</span> <span class="m">10</span> <span class="c1">⍝ The above as a train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│5 6 7 8 9│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;iotag&#39;</span><span class="nf">⎕CY</span><span class="s1">&#39;dfns&#39;</span> <span class="c1">⍝ iotag -- generalised iota</span>
<span class="m">12</span> <span class="nv">iotag</span> <span class="m">3</span> <span class="m">3</span> <span class="c1">⍝ 12 downto 3, step 3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────┐
│12 9 6 3│
└~───────┘
</span></div></div>
</div>
</div>
<div class="section" id="stencils">
<h1>Stencils<a class="headerlink" href="#stencils" title="Permalink to this headline">¶</a></h1>
<p>Pick out 3x3 regions of a larger matrix. The stencil takes a function to the left and a shape to the right and returns a monad.</p>
<p>This from https://chat.stackexchange.com/rooms/52405/conversation/lesson-5-even-more-apl-operators–</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">letters</span> <span class="kd">←</span> <span class="m">4</span> <span class="m">6</span><span class="o">⍴</span><span class="nf">⎕A</span>
<span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span> <span class="o">⊢</span> <span class="nv">letters</span>     <span class="c1">⍝ Enclose the selected window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
↓ABCDEF│
│GHIJKL│
│MNOPQR│
│STUVWX│
└──────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────┐
↓ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ ↓   │ ↓   │ ↓   │ ↓   │ ↓   │ ↓   │ │
│ │ AB│ │ABC│ │BCD│ │CDE│ │DEF│ │EF │ │
│ │ GH│ │GHI│ │HIJ│ │IJK│ │JKL│ │KL │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ │
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ ↓ AB│ ↓ABC│ ↓BCD│ ↓CDE│ ↓DEF│ ↓EF │ │
│ │ GH│ │GHI│ │HIJ│ │IJK│ │JKL│ │KL │ │
│ │ MN│ │MNO│ │NOP│ │OPQ│ │PQR│ │QR │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ │
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ ↓ GH│ ↓GHI│ ↓HIJ│ ↓IJK│ ↓JKL│ ↓KL │ │
│ │ MN│ │MNO│ │NOP│ │OPQ│ │PQR│ │QR │ │
│ │ ST│ │STU│ │TUV│ │UVW│ │VWX│ │WX │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ │
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ ↓ MN│ ↓MNO│ ↓NOP│ ↓OPQ│ ↓PQR│ ↓QR │ │
│ │ ST│ │STU│ │TUV│ │UVW│ │VWX│ │WX │ │
│ │   │ │   │ │   │ │   │ │   │ │   │ │
│ └───┘ └───┘ └───┘ └───┘ └───┘ └───┘ │
└∊────────────────────────────────────┘
</span></div></div>
</div>
<p>The padding is defined by ⍺ in the operand function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="p">)</span> <span class="o">⊢</span> <span class="nv">letters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────────────────────┐
↓ ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→───┐  │
│ │1 1│  │1 0│  │1 0│  │1 0│  │1 0│  │1 ¯1│  │
│ └~──┘  └~──┘  └~──┘  └~──┘  └~──┘  └~───┘  │
│ ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→───┐  │
│ │0 1│  │0 0│  │0 0│  │0 0│  │0 0│  │0 ¯1│  │
│ └~──┘  └~──┘  └~──┘  └~──┘  └~──┘  └~───┘  │
│ ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→──┐  ┌→───┐  │
│ │0 1│  │0 0│  │0 0│  │0 0│  │0 0│  │0 ¯1│  │
│ └~──┘  └~──┘  └~──┘  └~──┘  └~──┘  └~───┘  │
│ ┌→───┐ ┌→───┐ ┌→───┐ ┌→───┐ ┌→───┐ ┌→────┐ │
│ │¯1 1│ │¯1 0│ │¯1 0│ │¯1 0│ │¯1 0│ │¯1 ¯1│ │
│ └~───┘ └~───┘ └~───┘ └~───┘ └~───┘ └~────┘ │
└∊───────────────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺</span><span class="o">↓</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌺</span><span class="m">3</span> <span class="m">3</span><span class="p">)</span> <span class="o">⊢</span> <span class="nv">letters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────┐
↓ ┌→─┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ │
│ ↓AB│ ↓ABC│ ↓BCD│ ↓CDE│ ↓DEF│ ↓EF│ │
│ │GH│ │GHI│ │HIJ│ │IJK│ │JKL│ │KL│ │
│ └──┘ └───┘ └───┘ └───┘ └───┘ └──┘ │
│ ┌→─┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ │
│ ↓AB│ ↓ABC│ ↓BCD│ ↓CDE│ ↓DEF│ ↓EF│ │
│ │GH│ │GHI│ │HIJ│ │IJK│ │JKL│ │KL│ │
│ │MN│ │MNO│ │NOP│ │OPQ│ │PQR│ │QR│ │
│ └──┘ └───┘ └───┘ └───┘ └───┘ └──┘ │
│ ┌→─┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ │
│ ↓GH│ ↓GHI│ ↓HIJ│ ↓IJK│ ↓JKL│ ↓KL│ │
│ │MN│ │MNO│ │NOP│ │OPQ│ │PQR│ │QR│ │
│ │ST│ │STU│ │TUV│ │UVW│ │VWX│ │WX│ │
│ └──┘ └───┘ └───┘ └───┘ └───┘ └──┘ │
│ ┌→─┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→─┐ │
│ ↓MN│ ↓MNO│ ↓NOP│ ↓OPQ│ ↓PQR│ ↓QR│ │
│ │ST│ │STU│ │TUV│ │UVW│ │VWX│ │WX│ │
│ └──┘ └───┘ └───┘ └───┘ └───┘ └──┘ │
└∊──────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="key">
<h1>Key<a class="headerlink" href="#key" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="s1">&#39;Mississippi&#39;</span>  <span class="c1">⍝ Show indexes of items, by item</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
↓M 1        │
│i 2  5 8 11│
│s 3  4 6  7│
│p 9 10     │
└+──────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="s1">&#39;Mississippi&#39;</span> <span class="c1">⍝ Frequencies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓M 1│
│i 4│
│s 4│
│p 2│
└+──┘
</span></div></div>
</div>
<p>…or as tacit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="o">≢</span><span class="na">⌸</span><span class="p">)</span><span class="s1">&#39;Mississippi&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓M 1│
│i 4│
│s 4│
│p 2│
└+──┘
</span></div></div>
</div>
<p>Pick the most frequent item, returning all if several</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="p">(</span><span class="o">⊣</span><span class="na">/</span><span class="nv">m</span><span class="p">)</span><span class="na">/⍨</span><span class="nv">frq</span><span class="o">⍷</span><span class="na">⍨</span><span class="nv">frq</span><span class="o">⌷</span><span class="na">⍨</span><span class="o">⊃⍒</span><span class="nv">frq</span><span class="kd">←</span><span class="o">⊢</span><span class="na">/</span><span class="nv">m</span><span class="kd">←</span><span class="p">(</span><span class="o">,</span><span class="na">∘</span><span class="o">≢</span><span class="na">⌸</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span> <span class="s1">&#39;Mississippi&#39;</span> <span class="c1">⍝ Most frequent</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─┐
│is│
└──┘
</span></div></div>
</div>
</div>
<div class="section" id="sliding-tiles-example">
<h1>Sliding Tiles example<a class="headerlink" href="#sliding-tiles-example" title="Permalink to this headline">¶</a></h1>
<p>With ample help from &#64;ngn on APL Orchard.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">moves</span><span class="kd">←</span><span class="kt">{</span>
     <span class="nv">d</span><span class="kd">←</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">¯1</span><span class="p">)(</span><span class="m">¯1</span> <span class="m">0</span><span class="p">)</span>      <span class="c1">⍝ Move offsets</span>
     <span class="nv">m</span><span class="kd">←</span><span class="bp">⍵</span>
     <span class="kt">{</span><span class="o">⌽</span><span class="na">@</span><span class="nv">i</span> <span class="bp">⍵</span><span class="o">⊢</span><span class="nv">m</span><span class="kt">}</span><span class="na">¨</span><span class="p">(</span><span class="o">,⍳⍴</span><span class="nv">m</span><span class="p">)</span><span class="o">∩</span><span class="nv">d</span><span class="o">+⊂</span><span class="nv">i</span><span class="kd">←</span><span class="o">⊃⍸</span><span class="m">0</span><span class="o">=</span><span class="nv">m</span>
 <span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">state</span><span class="kd">←</span><span class="m">¯1</span><span class="o">+</span><span class="m">4</span> <span class="m">4</span><span class="o">⍴?</span><span class="na">⍨</span><span class="m">16</span>
<span class="nv">moves</span> <span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────┐
│ ┌→──────────┐ ┌→─────────┐ │
│ ↓14  0  9  8│ ↓1 14  9  8│ │
│ │ 1  3  6  2│ │0  3  6  2│ │
│ │ 4 13  7 10│ │4 13  7 10│ │
│ │ 5 12 11 15│ │5 12 11 15│ │
│ └~──────────┘ └~─────────┘ │
└∊───────────────────────────┘
</span></div></div>
</div>
<p>A lot to decode here. The <code class="docutils literal notranslate"><span class="pre">i</span></code> expression gives the row-col of the 0 element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">state</span> <span class="p">⋄</span> <span class="o">⊃⍸</span><span class="m">0</span><span class="o">=</span><span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
↓0 14  9  8│
│1  3  6  2│
│4 13  7 10│
│5 12 11 15│
└~─────────┘
┌→──┐
│1 1│
└~──┘
</span></div></div>
</div>
<p>Adding the offsets gives all potential moves:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">d</span><span class="kd">←</span><span class="p">(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">¯1</span><span class="p">)(</span><span class="m">¯1</span> <span class="m">0</span><span class="p">)</span>
<span class="nv">d</span><span class="o">+⊂</span><span class="nv">i</span><span class="kd">←</span><span class="o">⊃⍸</span><span class="m">0</span><span class="o">=</span><span class="nv">state</span>                <span class="c1">⍝ disclose-enclose as we want the enclosed version later</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ │
│ │1 2│ │2 1│ │1 0│ │0 1│ │
│ └~──┘ └~──┘ └~──┘ └~──┘ │
└∊────────────────────────┘
</span></div></div>
</div>
<p>Given the rank of m we can generate all valid coordinate pairs</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">,⍳⍴</span><span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────────────────────────────────────────────────
│ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐ ┌→──┐
│ │1 1│ │1 2│ │1 3│ │1 4│ │2 1│ │2 2│ │2 3│ │2 4│ │3 1│ │3 2│ │3 3│ │3 4│ │4 1│
│ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘ └~──┘
└∊─────────────────────────────────────────────────────────────────────────────

      ───────────────────┐
       ┌→──┐ ┌→──┐ ┌→──┐ │
       │4 2│ │4 3│ │4 4│ │
       └~──┘ └~──┘ └~──┘ │
      ───────────────────┘
</span></div></div>
</div>
<p>and then discard the moves that falls out of range as an intersection:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">,⍳⍴</span><span class="nv">state</span><span class="p">)</span><span class="o">∩</span><span class="nv">d</span><span class="o">+⊂</span><span class="nv">i</span><span class="kd">←</span><span class="o">⊃⍸</span><span class="m">0</span><span class="o">=</span><span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────┐
│ ┌→──┐ ┌→──┐ │
│ │1 2│ │2 1│ │
│ └~──┘ └~──┘ │
└∊────────────┘
</span></div></div>
</div>
<p>We now map <code class="docutils literal notranslate"><span class="pre">{⌽&#64;i</span> <span class="pre">⍵⊢m}</span></code> over the list of valid moves. How does that work?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⌽</span><span class="na">@</span><span class="nv">i</span> <span class="bp">⍵</span><span class="o">⊢</span><span class="nv">state</span><span class="kt">}</span><span class="na">¨</span><span class="p">(</span><span class="o">,⍳⍴</span><span class="nv">state</span><span class="p">)</span><span class="o">∩</span><span class="nv">d</span><span class="o">+⊂</span><span class="nv">i</span><span class="kd">←</span><span class="o">⊃⍸</span><span class="m">0</span><span class="o">=</span><span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────────────────────┐
│ ┌→──────────┐ ┌→─────────┐ │
│ ↓14  0  9  8│ ↓1 14  9  8│ │
│ │ 1  3  6  2│ │0  3  6  2│ │
│ │ 4 13  7 10│ │4 13  7 10│ │
│ │ 5 12 11 15│ │5 12 11 15│ │
│ └~──────────┘ └~─────────┘ │
└∊───────────────────────────┘
</span></div></div>
</div>
<p>The dyadic <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> glyph in this case applies the reverse function <code class="docutils literal notranslate"><span class="pre">⌽</span></code> on the set of indexes given to its right argument. For example, if we want to switch the elements at (1 1) and (1 2) in m, we could say:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">state</span> <span class="p">⋄</span> <span class="p">(</span><span class="o">⌽</span><span class="na">@</span><span class="p">(</span><span class="m">1</span> <span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="m">1</span> <span class="m">2</span><span class="p">))</span> <span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────┐
↓0 14  9  8│
│1  3  6  2│
│4 13  7 10│
│5 12 11 15│
└~─────────┘
┌→──────────┐
↓14  0  9  8│
│ 1  3  6  2│
│ 4 13  7 10│
│ 5 12 11 15│
└~──────────┘
</span></div></div>
</div>
<p>Using the right-tack <code class="docutils literal notranslate"><span class="pre">⊢</span></code> we can drop the brackets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌽</span><span class="na">@</span><span class="p">(</span><span class="m">1</span> <span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="m">1</span> <span class="m">2</span><span class="p">)</span> <span class="o">⊢</span> <span class="nv">state</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
↓14  0  9  8│
│ 1  3  6  2│
│ 4 13  7 10│
│ 5 12 11 15│
└~──────────┘
</span></div></div>
</div>
</div>
<div class="section" id="a-heap-implemented-as-a-leftist-tree">
<h1>A heap implemented as a Leftist Tree<a class="headerlink" href="#a-heap-implemented-as-a-leftist-tree" title="Permalink to this headline">¶</a></h1>
<p>A heap is a data structure that can be implemented as a Leftist Tree, which lends itself naturally to a recursive implementation.</p>
<p>https://en.wikipedia.org/wiki/Leftist_tree
http://typeocaml.com/2015/03/12/heap-leftist-tree/</p>
<p>Here is a partial port of the OCaml version.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Pop</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Pop off smallest element from a leftist tree ⍵</span>
    <span class="m">0</span><span class="o">=≢</span><span class="bp">⍵:</span><span class="no">⍬</span>
    <span class="p">(</span><span class="nv">value</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span><span class="kd">←</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span>
    <span class="p">(</span><span class="nv">left</span> <span class="nv">Merge</span> <span class="nv">right</span><span class="p">)</span> <span class="nv">value</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Push</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Insert item ⍵ into leftist tree ⍺, returning the resulting tree</span>
    <span class="bp">⍺</span><span class="kd">←</span><span class="no">⍬</span>              <span class="c1">⍝ default to init</span>
    <span class="m">1</span> <span class="bp">⍵</span> <span class="no">⍬</span> <span class="no">⍬</span> <span class="nv">Merge</span> <span class="bp">⍺</span> 
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Merge</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Merge leftist trees ⍺ and ⍵</span>
    <span class="m">0</span><span class="o">=≢</span><span class="bp">⍺:⍵</span> <span class="p">⋄</span> <span class="m">0</span><span class="o">=≢</span><span class="bp">⍵:⍺</span>                                 <span class="c1">⍝ If either is a leaf, return the other</span>
    <span class="p">(</span><span class="nv">key</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span><span class="kd">←</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍺</span>
    <span class="nv">key</span><span class="o">&gt;</span><span class="p">(</span><span class="nf">⎕IO</span><span class="o">+</span><span class="m">1</span><span class="p">)</span><span class="o">⊃</span><span class="bp">⍵:⍵∇⍺</span>                               <span class="c1">⍝ Flip to ensure smallest is root of merged</span>
    <span class="nv">merged</span><span class="kd">←</span><span class="nv">right</span><span class="bp">∇⍵</span>                                  <span class="c1">⍝ Merge rightwards</span>
    <span class="nv">leftRank</span><span class="kd">←</span><span class="o">⊃</span><span class="nv">left</span> <span class="p">⋄</span> <span class="nv">mergedRank</span><span class="kd">←</span><span class="o">⊃</span><span class="nv">merged</span>
    <span class="nv">leftRank</span><span class="o">≥⊃</span><span class="nv">merged</span><span class="bp">:</span><span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">mergedRank</span><span class="p">)</span> <span class="nv">key</span> <span class="nv">left</span> <span class="nv">merged</span> <span class="c1">⍝ Right is shorter</span>
    <span class="p">(</span><span class="m">1</span><span class="o">+</span><span class="nv">leftRank</span><span class="p">)</span> <span class="nv">key</span> <span class="nv">merged</span> <span class="nv">left</span>                    <span class="c1">⍝ Left is shorter; make it the new right</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ Example given in http://typeocaml.com/2015/03/12/heap-leftist-tree/</span>
<span class="nv">h</span><span class="kd">←</span><span class="nv">Push</span> <span class="m">2</span>
<span class="nv">h</span> <span class="nv">Push</span><span class="kd">←</span><span class="m">10</span>
<span class="nv">h</span> <span class="nv">Push</span><span class="kd">←</span><span class="m">9</span>

<span class="nv">s</span><span class="kd">←</span><span class="nv">Push</span> <span class="m">3</span>
<span class="nv">s</span> <span class="nv">Push</span><span class="kd">←</span><span class="m">6</span>

<span class="nv">h</span> <span class="nv">Merge</span> <span class="nv">s</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────────────────────────────────┐
│     ┌→────────────────────────────────────┐ ┌→─────────────┐ │
│ 2 2 │     ┌→────────────┐ ┌→────────────┐ │ │      ┌⊖┐ ┌⊖┐ │ │
│     │ 2 3 │     ┌⊖┐ ┌⊖┐ │ │     ┌⊖┐ ┌⊖┐ │ │ │ 1 10 │0│ │0│ │ │
│     │     │ 1 6 │0│ │0│ │ │ 1 9 │0│ │0│ │ │ │      └~┘ └~┘ │ │
│     │     │     └~┘ └~┘ │ │     └~┘ └~┘ │ │ └∊─────────────┘ │
│     │     └∊────────────┘ └∊────────────┘ │                  │
│     └∊────────────────────────────────────┘                  │
└∊─────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>More compact, and a more natural fit for APL. Note that the Leftist Tree has slightly different performance characteristics to the standard heap.</p>
</div>
<div class="section" id="strings">
<h1>Strings<a class="headerlink" href="#strings" title="Permalink to this headline">¶</a></h1>
<p>Lower/upper-case a string</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">819</span><span class="na">⌶</span><span class="p">)</span> <span class="s1">&#39;Hello All People in The World&#39;</span>   <span class="c1">⍝ NOTE: deprecated in Dyalog 18.X in favour of ⎕C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────┐
│hello all people in the world│
└─────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span><span class="p">(</span><span class="m">819</span><span class="na">⌶</span><span class="p">)</span> <span class="s1">&#39;Hello All People in The World&#39;</span>  <span class="c1">⍝ NOTE: deprecated in Dyalog 18.X in favour of ⎕C</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────┐
│HELLO ALL PEOPLE IN THE WORLD│
└─────────────────────────────┘
</span></div></div>
</div>
<p>We can also use regular expressions, of course:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="o">⊃</span><span class="p">(</span><span class="s1">&#39;.+&#39;</span> <span class="nf">⎕S</span> <span class="s1">&#39;\u0&#39;</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span> <span class="s1">&#39;Hello All People in The World&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────┐
│HELLO ALL PEOPLE IN THE WORLD│
└─────────────────────────────┘
</span></div></div>
</div>
<p>As we saw earlier, we can split a string on a regex pattern:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">RegSplit</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">⊢</span><span class="na">/¨</span><span class="nv">r</span><span class="p">)</span><span class="o">↓</span><span class="na">¨</span><span class="bp">⍵</span><span class="o">⊂</span><span class="na">⍨</span><span class="p">(</span><span class="o">⍳≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∊</span><span class="m">1</span><span class="o">+⊃</span><span class="na">¨</span><span class="nv">r</span><span class="kd">←</span><span class="p">(</span><span class="bp">⍺</span><span class="o">,</span><span class="s1">&#39;|^&#39;</span><span class="p">)</span><span class="nf">⎕S</span> <span class="m">0</span> <span class="m">1</span><span class="o">⊢</span><span class="bp">⍵</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/+&#39;</span> <span class="nv">RegSplit</span> <span class="s1">&#39;here/////be/dragons/&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────┐
│ ┌→───┐ ┌→─┐ ┌→──────┐ ┌⊖┐ │
│ │here│ │be│ │dragons│ │ │ │
│ └────┘ └──┘ └───────┘ └─┘ │
└∊──────────────────────────┘
</span></div></div>
</div>
<p>…or simply on a separator char</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39; &#39;</span> <span class="p">(</span><span class="o">≠⊆⊢</span><span class="p">)</span> <span class="s1">&#39;hello world out there&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────┐
│ ┌→────┐ ┌→────┐ ┌→──┐ ┌→────┐ │
│ │hello│ │world│ │out│ │there│ │
│ └─────┘ └─────┘ └───┘ └─────┘ │
└∊──────────────────────────────┘
</span></div></div>
</div>
<div class="section" id="binary-operations">
<h2>Binary operations<a class="headerlink" href="#binary-operations" title="Permalink to this headline">¶</a></h2>
<p>Convert a decimal number to binary:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">2</span><span class="na">∘</span><span class="o">⊥</span><span class="na">⍣</span><span class="m">¯1</span><span class="p">)</span> <span class="m">54</span>
<span class="p">(</span><span class="m">16</span><span class="o">⍴</span><span class="m">2</span><span class="p">)</span><span class="o">⊤</span><span class="m">54</span>      <span class="c1">⍝ Fixed number of bits</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│1 1 0 1 1 0│
└~──────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────┐
│0 0 0 0 0 0 0 0 0 0 1 1 0 1 1 0│
└~──────────────────────────────┘
</span></div></div>
</div>
<p>Binary to decimal:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">2</span><span class="o">⊥</span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">  
54

</span></div></div>
</div>
<p>The boolean functions ∨∧⍲⍱≠~ etc all work as expected on binary vectors</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="o">∧</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│0 0 0 0 1 0│
└~──────────┘
</span></div></div>
</div>
<p>To right, and left shift we can use the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Lshift</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍵</span><span class="o">↓</span><span class="bp">⍺</span><span class="kt">}</span>
<span class="nv">Rshift</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">-≢</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="p">(</span><span class="o">-</span><span class="bp">⍵</span><span class="p">)</span><span class="o">↓</span><span class="bp">⍺</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="nv">Rshift</span> <span class="m">2</span>
<span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span> <span class="nv">Lshift</span> <span class="m">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│0 0 1 1 0 1│
└~──────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────┐
│0 1 1 0 0 0│
└~──────────┘
</span></div></div>
</div>
</div>
<div class="section" id="todo-unsorted">
<h2>TODO UNSORTED<a class="headerlink" href="#todo-unsorted" title="Permalink to this headline">¶</a></h2>
<p>83 ¯1⎕MAP filename ⍝ read raw bytes
{⍺⎕UCS¨⍨⊂’-\w+$’⎕R’’⊢⍵}/2↑⎕NGET ‘data/2015/08.txt’ 1 ⍝ read raw bytes</p>
<p>(∪⍳⊢)Y ⍝ convert strings to IDs
a⌹a=a  average
(⍕≡⊢)Y ⍝ is Y simple character array?
(1=2|⎕DR)Y ⍝ is Y all numeric</p>
<p>v←{A←⊃∘.+/3⍴⊂⍳100 ⋄ ⊃,/{⍵,¨⍸(100-⍵)=A}¨⍳100}⍬ ⍝ stars &amp; bars</p>
<p>best⊣⍣(~value&lt;best)←value  ⍝ if value &lt; best then best=value</p>
</div>
<div class="section" id="json">
<h2>JSON<a class="headerlink" href="#json" title="Permalink to this headline">¶</a></h2>
<p>Parse a JSON-string into nested namespaces where needed:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">JSONSTR</span><span class="kd">←</span><span class="s1">&#39;{&quot;key11&quot;:&quot;value11&quot;,&quot;key12&quot;:{&quot;key121&quot;:&quot;value121&quot;},&quot;key13&quot;:[1,2,3]}&#39;</span>
<span class="vg">⎕</span><span class="kd">←</span><span class="nv">data</span><span class="kd">←</span><span class="nf">⎕JSON</span> <span class="nv">JSONSTR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">               
#.[JSON object]

</span></div></div>
</div>
<p>This contains the names of simple keys and the names of references (dicts) as separate entries in the namespace:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="na">.</span><span class="p">(</span><span class="nf">⎕NL</span> <span class="m">¯2</span><span class="p">)</span>  <span class="c1">⍝ Simple keys</span>
<span class="nv">data</span><span class="na">.</span><span class="p">(</span><span class="nf">⎕NL</span> <span class="m">¯9</span><span class="p">)</span>  <span class="c1">⍝ Object references</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
│ ┌→────┐ ┌→────┐ │
│ │key11│ │key13│ │
│ └─────┘ └─────┘ │
└∊────────────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│ ┌→────┐ │
│ │key12│ │
│ └─────┘ │
└∊────────┘
</span></div></div>
</div>
<p>Negating the argument to ⎕NL simply means return as a nested vector, rather than as an array.</p>
<p>To get the corresponding values, we simply execute the entries returned by ⎕NL:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="kd">←</span><span class="nv">simpleValues</span><span class="kd">←</span><span class="nv">data</span><span class="na">.</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="nf">⎕NL</span> <span class="m">¯2</span><span class="p">)</span>
<span class="vg">⎕</span><span class="kd">←</span><span class="nv">objectValues</span><span class="kd">←</span><span class="nv">data</span><span class="na">.</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="nf">⎕NL</span> <span class="m">¯9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
│ ┌→──────┐ ┌→────┐ │
│ │value11│ │1 2 3│ │
│ └───────┘ └~────┘ │
└∊──────────────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────┐
│ #.[JSON object].[JSON object] │
└#──────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="c1">⍝ CHECK: (↑⍣≡0∘⎕JSON)Y</span>
<span class="c1">⍝ (1⎕JSON{1&lt;≢⍴⍵:∇¨⊂⍤¯1⊢⍵ ⋄ ⍵})Y apl-&gt;json</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="namespaces">
<h2>Namespaces<a class="headerlink" href="#namespaces" title="Permalink to this headline">¶</a></h2>
<p>Namespaces is the way to create objects, records or structs in Dyalog.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="kd">←</span><span class="nf">⎕NS</span><span class="s1">&#39;&#39;</span>  <span class="c1">⍝ Create an anonymous namespace                 </span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">a</span><span class="na">.</span><span class="p">(</span><span class="nv">Name</span> <span class="nv">City</span><span class="p">)</span><span class="kd">←</span> <span class="s1">&#39;Stefan&#39;</span> <span class="s1">&#39;Bristol&#39;</span>  <span class="c1">⍝ Assign two fields</span>
<span class="nv">a</span><span class="na">.</span><span class="nv">Name</span> <span class="p">⋄</span> <span class="nv">a</span><span class="na">.</span><span class="nv">City</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────┐
│Stefan│
└──────┘
┌→──────┐
│Bristol│
└───────┘
</span></div></div>
</div>
</div>
<div class="section" id="introspection-and-typing">
<h2>Introspection and typing<a class="headerlink" href="#introspection-and-typing" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">IsNumber</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=</span><span class="m">2</span><span class="o">|</span><span class="nf">⎕DR</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>                     <span class="c1">⍝ Are we a number?</span>
<span class="nv">IsString</span><span class="kd">←</span><span class="o">⍕≡⊢</span>                              <span class="c1">⍝ Are we a string?</span>
<span class="nv">IsNamespace</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="m">326</span><span class="o">=</span><span class="nf">⎕DR</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>                  <span class="c1">⍝ Are we a reference/object/namespace?</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="performance-comparisons">
<h2>Performance comparisons<a class="headerlink" href="#performance-comparisons" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">b</span><span class="kd">←</span><span class="o">↑</span><span class="kt">{</span><span class="p">(</span><span class="bp">⍵</span> <span class="m">1</span><span class="p">)</span> <span class="p">(</span><span class="m">0</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span><span class="na">¨</span><span class="o">⍳</span><span class="m">10000</span>
<span class="nv">vs</span><span class="kd">←</span><span class="o">⍳</span><span class="m">10000</span>
<span class="nv">rs</span><span class="kd">←</span><span class="o">?</span><span class="na">⍨</span><span class="m">10000</span>

<span class="sr">]</span><span class="nv">runtime</span> <span class="o">-</span><span class="nv">c</span> <span class="s2">&quot;vs,¨⍨@1⍤0 1@rs⊢b&quot;</span> <span class="s2">&quot;(,¨∘vs)@(rs,¨1)⊢b&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────────────────────────────────────┐
↓                                                                             │
│  vs,¨⍨@1⍤0 1@rs⊢b  → 9.1E¯3 |   0% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕ │
│  (,¨∘vs)@(rs,¨1)⊢b → 4.3E¯3 | -54% ⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕⎕                      │
└─────────────────────────────────────────────────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="grouping">
<h2>Grouping<a class="headerlink" href="#grouping" title="Permalink to this headline">¶</a></h2>
<p>Given a vector of integer pairs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>m1←(5 3)(5 6)(7 5)(4 7)(1 8)(2 4)(1 2)
</pre></div>
</div>
<p>Group based on the first element of each pair to produce:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>m2←(5 (3 6))(7 (,5)) (4 (,7)) (1 (8 2)) (2 (,4))
</pre></div>
</div>
<p>Method 1: sort, and partition-enclose:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">m1</span><span class="kd">←</span><span class="p">(</span><span class="m">5</span> <span class="m">3</span><span class="p">)(</span><span class="m">5</span> <span class="m">6</span><span class="p">)(</span><span class="m">7</span> <span class="m">5</span><span class="p">)(</span><span class="m">4</span> <span class="m">7</span><span class="p">)(</span><span class="m">1</span> <span class="m">8</span><span class="p">)(</span><span class="m">2</span> <span class="m">4</span><span class="p">)(</span><span class="m">1</span> <span class="m">2</span><span class="p">)</span>
<span class="nv">data</span><span class="kd">←</span><span class="p">(</span><span class="o">↑</span><span class="nv">m1</span><span class="p">)</span><span class="sr">[</span><span class="o">⍋</span><span class="p">(</span><span class="o">↑</span><span class="nv">m1</span><span class="p">)</span><span class="sr">[;</span><span class="m">1</span><span class="sr">];]</span>
<span class="nv">k</span><span class="kd">←</span><span class="o">⊣</span><span class="na">/</span><span class="nv">data</span>
<span class="o">↓⍉↑</span><span class="p">(</span><span class="o">∪</span><span class="nv">k</span><span class="p">)(</span><span class="nv">k</span><span class="o">⊆⊢</span><span class="na">/</span><span class="nv">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→────────┐ ┌→──────┐ ┌→──────┐ ┌→────────┐ ┌→──────┐ │
│ │   ┌→──┐ │ │   ┌→┐ │ │   ┌→┐ │ │   ┌→──┐ │ │   ┌→┐ │ │
│ │ 1 │8 2│ │ │ 2 │4│ │ │ 4 │7│ │ │ 5 │3 6│ │ │ 7 │5│ │ │
│ │   └~──┘ │ │   └~┘ │ │   └~┘ │ │   └~──┘ │ │   └~┘ │ │
│ └∊────────┘ └∊──────┘ └∊──────┘ └∊────────┘ └∊──────┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Method 2: use key:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊃</span><span class="na">¨</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍺⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="o">⊢</span><span class="na">/¨</span><span class="p">)</span><span class="nv">m1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→────────┐ ┌→──────┐ ┌→──────┐ ┌→────────┐ ┌→──────┐ │
│ │   ┌→──┐ │ │   ┌→┐ │ │   ┌→┐ │ │   ┌→──┐ │ │   ┌→┐ │ │
│ │ 5 │3 6│ │ │ 7 │5│ │ │ 4 │7│ │ │ 1 │8 2│ │ │ 2 │4│ │ │
│ │   └~──┘ │ │   └~┘ │ │   └~┘ │ │   └~──┘ │ │   └~┘ │ │
│ └∊────────┘ └∊──────┘ └∊──────┘ └∊────────┘ └∊──────┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
<p>or more tacitly,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">↓⊃</span><span class="na">¨</span><span class="o">,</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌸</span><span class="o">⊢</span><span class="na">/¨</span><span class="p">)</span><span class="nv">m1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────────────┐
│ ┌→────────┐ ┌→──────┐ ┌→──────┐ ┌→────────┐ ┌→──────┐ │
│ │   ┌→──┐ │ │   ┌→┐ │ │   ┌→┐ │ │   ┌→──┐ │ │   ┌→┐ │ │
│ │ 5 │3 6│ │ │ 7 │5│ │ │ 4 │7│ │ │ 1 │8 2│ │ │ 2 │4│ │ │
│ │   └~──┘ │ │   └~┘ │ │   └~┘ │ │   └~──┘ │ │   └~┘ │ │
│ └∊────────┘ └∊──────┘ └∊──────┘ └∊────────┘ └∊──────┘ │
└∊──────────────────────────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="odd-one-out">
<h2>Odd one out<a class="headerlink" href="#odd-one-out" title="Permalink to this headline">¶</a></h2>
<p>Given a simple vector where all items are equal, bar one, find the index of the odd one out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">vect</span><span class="kd">←</span><span class="m">243</span> <span class="m">243</span> <span class="m">243</span> <span class="m">243</span> <span class="m">251</span> <span class="m">243</span> <span class="m">243</span>
</pre></div>
</div>
</div>
</div>
<p>Naively, use key <code class="docutils literal notranslate"><span class="pre">⌸</span></code> to make the histogram, find the location of the single 1 in the counts column, pick the corresponding value and then locate the index in the vector:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">hist</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">,≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">d</span>
<span class="nv">oneIndex</span><span class="kd">←</span><span class="nv">hist</span><span class="sr">[;</span><span class="m">2</span><span class="sr">]</span><span class="o">⍳</span><span class="m">1</span>
<span class="nv">oddVal</span><span class="kd">←</span><span class="nv">hist</span><span class="sr">[</span><span class="nv">oneIndex</span><span class="sr">;</span><span class="m">1</span><span class="sr">]</span>
<span class="nv">vect</span><span class="o">⍳</span><span class="nv">oddVal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
8

</span></div></div>
</div>
<p>We can compress this basic approach by doing more work in the key operand:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊</span><span class="kt">{</span><span class="o">⊂</span><span class="bp">⍵</span><span class="na">/⍨</span><span class="m">1</span><span class="o">=≢</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">vect</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→┐
│5│
└~┘
</span></div></div>
</div>
<p>This finds the places where the count is 1 and emits the corresponding index. Recall that the <code class="docutils literal notranslate"><span class="pre">⍵</span></code> in the operand is a set of indexes for each unique element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="kt">{</span><span class="bp">⍺</span> <span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">vect</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────┐
↓     ┌→──────────┐ │
│ 243 │1 2 3 4 6 7│ │
│     └~──────────┘ │
│     ┌→┐           │
│ 251 │5│           │
│     └~┘           │
└∊──────────────────┘
</span></div></div>
</div>
<p>A different approach is to reduce the indices with intersect <code class="docutils literal notranslate"><span class="pre">∩</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊</span><span class="kt">{</span><span class="o">∩</span><span class="na">/</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">⌸</span><span class="nv">vect</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→┐
│5│
└~┘
</span></div></div>
</div>
<p>It’s perhaps not obvious how this works. We know that the elements of <code class="docutils literal notranslate"><span class="pre">⍵</span></code> will be unique, so the reduction will always be empty, unless the vector contains a single element:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊∩</span><span class="na">/</span><span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">6</span> <span class="m">7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌⊖┐
│0│
└~┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">∊∩</span><span class="na">/</span><span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→┐
│5│
└~┘
</span></div></div>
</div>
<p>A completely different approach is to look for elements in the vector that differs from both its neighbours, wrapping around at the edges:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">∧</span><span class="m">1</span><span class="o">⌽</span><span class="bp">⍵</span><span class="kt">}</span><span class="na">∘</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">≠</span><span class="m">¯1</span><span class="o">⌽</span><span class="bp">⍵</span><span class="kt">}</span><span class="nv">vect</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→┐
│5│
└~┘
</span></div></div>
</div>
<p>Another suggestion from the APLOrchard:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="m">1</span><span class="o">⍳</span><span class="na">⍨</span><span class="m">1</span><span class="o">⊥</span><span class="na">∘.</span><span class="o">=</span><span class="na">⍨</span><span class="p">)</span><span class="nv">vect</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
5

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">assert</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="kd">←</span><span class="s1">&#39;assertion failure&#39;</span> <span class="p">⋄</span> <span class="m">0</span><span class="o">∊</span><span class="bp">⍵:⍺</span> <span class="nf">⎕signal</span> <span class="m">8</span> <span class="p">⋄</span> <span class="nv">shy</span><span class="kd">←</span><span class="m">0</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<p>Index of smallest element</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">elems</span><span class="o">⍳⌊</span><span class="na">/</span><span class="nv">elems</span><span class="kd">←</span><span class="m">6</span> <span class="m">2</span> <span class="m">8</span> <span class="m">9</span> <span class="m">3</span> <span class="m">1</span> <span class="m">10</span> <span class="m">15</span>
<span class="o">⊃⍋</span><span class="nv">elems</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
6

</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
6

</span></div></div>
</div>
</div>
<div class="section" id="partition-a-matrix-into-non-overlapping-sub-matrices-and-re-merge">
<h2>Partition a matrix into non-overlapping sub-matrices – and re-merge<a class="headerlink" href="#partition-a-matrix-into-non-overlapping-sub-matrices-and-re-merge" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span><span class="o">⍴</span><span class="m">2</span> <span class="m">2</span><span class="p">)</span><span class="o">⊢</span><span class="m">4</span> <span class="m">4</span><span class="o">⍴⍳</span><span class="m">16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
↓ ┌→──┐   ┌→──┐   │
│ ↓1 2│   ↓3 4│   │
│ │5 6│   │7 8│   │
│ └~──┘   └~──┘   │
│ ┌→────┐ ┌→────┐ │
│ ↓ 9 10│ ↓11 12│ │
│ │13 14│ │15 16│ │
│ └~────┘ └~────┘ │
└∊────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="m">1</span> <span class="m">1</span><span class="o">↓⊢</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span><span class="o">⍴</span><span class="m">3</span> <span class="m">3</span><span class="p">)</span><span class="o">⊢</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">12</span> <span class="m">12</span><span class="o">⍴⍳</span><span class="m">144</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────────────────────────────────────┐
↓ ┌→───────┐    ┌→───────┐    ┌→───────┐    ┌→───────┐    │
│ ↓ 1  2  3│    ↓ 4  5  6│    ↓ 7  8  9│    ↓10 11 12│    │
│ │13 14 15│    │16 17 18│    │19 20 21│    │22 23 24│    │
│ │25 26 27│    │28 29 30│    │31 32 33│    │34 35 36│    │
│ └~───────┘    └~───────┘    └~───────┘    └~───────┘    │
│ ┌→───────┐    ┌→───────┐    ┌→───────┐    ┌→───────┐    │
│ ↓37 38 39│    ↓40 41 42│    ↓43 44 45│    ↓46 47 48│    │
│ │49 50 51│    │52 53 54│    │55 56 57│    │58 59 60│    │
│ │61 62 63│    │64 65 66│    │67 68 69│    │70 71 72│    │
│ └~───────┘    └~───────┘    └~───────┘    └~───────┘    │
│ ┌→───────┐    ┌→──────────┐ ┌→──────────┐ ┌→──────────┐ │
│ ↓73 74 75│    ↓ 76  77  78│ ↓ 79  80  81│ ↓ 82  83  84│ │
│ │85 86 87│    │ 88  89  90│ │ 91  92  93│ │ 94  95  96│ │
│ │97 98 99│    │100 101 102│ │103 104 105│ │106 107 108│ │
│ └~───────┘    └~──────────┘ └~──────────┘ └~──────────┘ │
│ ┌→──────────┐ ┌→──────────┐ ┌→──────────┐ ┌→──────────┐ │
│ ↓109 110 111│ ↓112 113 114│ ↓115 116 117│ ↓118 119 120│ │
│ │121 122 123│ │124 125 126│ │127 128 129│ │130 131 132│ │
│ │133 134 135│ │136 137 138│ │139 140 141│ │142 143 144│ │
│ └~──────────┘ └~──────────┘ └~──────────┘ └~──────────┘ │
└∊────────────────────────────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="kd">←</span><span class="m">1</span> <span class="p">⋄</span> <span class="m">2</span> <span class="m">2</span> <span class="kt">{</span><span class="o">⊂</span><span class="sr">[</span><span class="m">2</span><span class="o">×⍳≢⍴</span><span class="bp">⍵</span><span class="sr">]</span><span class="bp">⍵</span><span class="o">⍴</span><span class="na">⍨</span><span class="o">∊</span><span class="bp">⍺</span><span class="o">,</span><span class="na">¨⍨</span><span class="bp">⍺</span><span class="o">÷</span><span class="na">⍨</span><span class="o">⍴</span><span class="bp">⍵</span><span class="kt">}</span> <span class="m">4</span> <span class="m">4</span> <span class="o">⍴</span> <span class="o">⍳</span><span class="m">16</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────┐
↓ ┌→──┐   ┌→──┐   │
│ ↓1 2│   ↓3 4│   │
│ │5 6│   │7 8│   │
│ └~──┘   └~──┘   │
│ ┌→────┐ ┌→────┐ │
│ ↓ 9 10│ ↓11 12│ │
│ │13 14│ │15 16│ │
│ └~────┘ └~────┘ │
└∊────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊂</span><span class="na">⍤</span><span class="m">2</span><span class="o">⊢</span><span class="m">1</span> <span class="m">3</span> <span class="m">2</span> <span class="m">4</span><span class="o">⍉</span><span class="m">2</span> <span class="m">3</span> <span class="m">2</span> <span class="m">3</span><span class="o">⍴</span><span class="m">6</span> <span class="m">6</span><span class="o">⍴⍳</span><span class="m">36</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────┐
↓ ┌→───────┐ ┌→───────┐ │
│ ↓ 1  2  3│ ↓ 4  5  6│ │
│ │ 7  8  9│ │10 11 12│ │
│ │13 14 15│ │16 17 18│ │
│ └~───────┘ └~───────┘ │
│ ┌→───────┐ ┌→───────┐ │
│ ↓19 20 21│ ↓22 23 24│ │
│ │25 26 27│ │28 29 30│ │
│ │31 32 33│ │34 35 36│ │
│ └~───────┘ └~───────┘ │
└∊──────────────────────┘
</span></div></div>
</div>
<p>To merge sub-matrices back to the original state:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">m</span><span class="kd">←</span><span class="m">1</span> <span class="m">1</span><span class="o">↓⊢</span><span class="na">∘</span><span class="o">⊂</span><span class="na">⌺</span><span class="p">(</span><span class="m">2</span> <span class="m">2</span><span class="o">⍴</span><span class="m">3</span> <span class="m">3</span><span class="p">)</span><span class="o">⊢</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">⍪</span><span class="m">0</span><span class="o">,</span><span class="m">0</span><span class="o">,</span><span class="m">12</span> <span class="m">12</span><span class="o">⍴⍳</span><span class="m">144</span>
<span class="nv">Merge</span><span class="kd">←</span><span class="kt">{</span><span class="p">((</span><span class="o">⍴×⍴</span><span class="na">∘</span><span class="o">⊃</span><span class="p">)</span><span class="o">⍴</span><span class="m">1</span> <span class="m">3</span> <span class="m">2</span> <span class="m">4</span><span class="o">⍉↑</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span>
<span class="nv">Merge</span> <span class="nv">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────────────────────────────────────────────┐
↓  1   2   3   4   5   6   7   8   9  10  11  12│
│ 13  14  15  16  17  18  19  20  21  22  23  24│
│ 25  26  27  28  29  30  31  32  33  34  35  36│
│ 37  38  39  40  41  42  43  44  45  46  47  48│
│ 49  50  51  52  53  54  55  56  57  58  59  60│
│ 61  62  63  64  65  66  67  68  69  70  71  72│
│ 73  74  75  76  77  78  79  80  81  82  83  84│
│ 85  86  87  88  89  90  91  92  93  94  95  96│
│ 97  98  99 100 101 102 103 104 105 106 107 108│
│109 110 111 112 113 114 115 116 117 118 119 120│
│121 122 123 124 125 126 127 128 129 130 131 132│
│133 134 135 136 137 138 139 140 141 142 143 144│
└~──────────────────────────────────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="neighbourhoods">
<h2>Neighbourhoods<a class="headerlink" href="#neighbourhoods" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span><span class="kd">←</span><span class="o">⍸×</span><span class="m">3</span> <span class="m">3</span> <span class="o">⍴</span> <span class="m">5</span> <span class="m">0</span> <span class="m">4</span> <span class="m">0</span> <span class="m">0</span> <span class="m">3</span> <span class="m">0</span> <span class="m">2</span> <span class="m">0</span> <span class="c1">⍝ All non-zero coord pairs</span>
<span class="nv">n4</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">∩</span><span class="bp">⍵</span><span class="p">(</span><span class="o">+,-</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)</span><span class="kt">}</span>
<span class="nv">n8</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">∩</span><span class="bp">⍵</span><span class="p">(</span><span class="o">+,-</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">¯1</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">1</span><span class="p">)</span><span class="kt">}</span>
<span class="nv">Move</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="s1">&#39;NESW&#39;</span><span class="o">⍳</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊃</span><span class="p">(</span><span class="m">¯1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">1</span><span class="p">)(</span><span class="m">1</span> <span class="m">0</span><span class="p">)(</span><span class="m">0</span> <span class="m">¯1</span><span class="p">)</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">v</span> <span class="nv">n4</span> <span class="o">⊂</span><span class="m">2</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──────┐
│ ┌→──┐ │
│ │1 3│ │
│ └~──┘ │
└∊──────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">alupsert</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="nv">k</span> <span class="nv">v</span><span class="p">)</span><span class="kd">←</span><span class="bp">⍵</span><span class="p">⋄</span><span class="m">3</span><span class="bp">::⍺</span> <span class="nv">alpush</span> <span class="nv">k</span> <span class="nv">v</span><span class="p">⋄</span><span class="bp">⍺</span> <span class="nv">alset</span> <span class="nv">k</span> <span class="nv">v</span><span class="kt">}</span> <span class="c1">⍝ Modify if present</span>
<span class="nv">algetd</span><span class="kd">←</span><span class="kt">{</span><span class="m">3</span><span class="bp">::</span><span class="m">¯1</span><span class="o">↑</span><span class="bp">⍵</span><span class="p">⋄</span><span class="bp">⍺</span> <span class="nv">alget</span> <span class="p">(</span><span class="o">⊃</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span>                  <span class="c1">⍝ Get if present, else return given default</span>
</pre></div>
</div>
</div>
</div>
<p>Atop: One way to look at f∘g vs f⍤g is that when given a left argument, ∘ gives it to the left-hand function and ⍤ gives it to the right-hand function. Other than that, they are equivalent</p>
<p>Another way to look at f∘g vs f⍤g is simply choosing order of the first two tokens: X f∘g Y computes X f g Y and X f⍤g Y computes f X g Y</p>
<p>Over: So, remember how f∘g preprocesses the right argument of f using g?
One way to look at Over is simply as preprocessing all arguments of f using g.
“All” as in <em>both or the only</em>.</p>
<p>So again f⍥g Y is the same as f⍤g Y and f∘g Y. The difference is again when we do a dyadic application.</p>
<p>So while X f∘g Y is X f(g Y) we have X f⍥g Y be (g X)f(g Y).</p>
<p>One of my favourites lately is ,⍥⊂ which I prefer over {⍺ ⍵}</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;YYYY DD MM hhmm&#39;</span><span class="p">(</span><span class="m">1200</span><span class="na">⌶</span><span class="p">)</span><span class="m">1</span><span class="nf">⎕DT</span><span class="o">⊂</span><span class="m">2020</span> <span class="m">08</span> <span class="m">11</span> <span class="m">11</span> <span class="m">32</span> <span class="c1">⍝ Dyalog 18 date time</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────────┐
│ ┌→──────────────┐ │
│ │2020 11 08 1132│ │
│ └───────────────┘ │
└∊──────────────────┘
</span></div></div>
</div>
</div>
<div class="section" id="constrain-a-set-of-coordinates-to-a-rectangle">
<h2>Constrain a set of coordinates to a rectangle<a class="headerlink" href="#constrain-a-set-of-coordinates-to-a-rectangle" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕io</span><span class="kd">←</span><span class="m">0</span>
<span class="nv">YMIN</span><span class="kd">←</span><span class="m">0</span> <span class="p">⋄</span> <span class="nv">YMAX</span><span class="kd">←</span><span class="m">50</span> <span class="p">⋄</span> <span class="nv">XMIN</span><span class="kd">←</span><span class="m">0</span> <span class="p">⋄</span> <span class="nv">XMAX</span><span class="kd">←</span><span class="m">50</span>
<span class="nv">c</span><span class="kd">←</span><span class="p">(</span><span class="m">23</span> <span class="m">43</span><span class="p">)(</span><span class="m">78</span> <span class="m">34</span><span class="p">)(</span><span class="m">¯45</span> <span class="m">34</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃∧</span><span class="na">/</span><span class="m">0</span><span class="o">=</span><span class="p">(</span><span class="nv">YMIN</span> <span class="nv">YMAX</span><span class="p">)</span> <span class="p">(</span><span class="nv">XMIN</span> <span class="nv">XMAX</span><span class="p">)</span><span class="o">⍸</span><span class="na">¨</span><span class="o">↓⍉↑</span><span class="nv">c</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│1 0 0│
└~────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊢≡</span><span class="nv">YMIN</span> <span class="nv">XMIN</span><span class="o">⌈</span><span class="nv">YMAX</span> <span class="nv">XMAX</span><span class="o">⌊⊢</span><span class="p">)</span><span class="na">¨</span><span class="nv">c</span>          <span class="c1">⍝ Slower</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│1 0 0│
└~────┘
</span></div></div>
</div>
</div>
</div>
<div class="section" id="noddy-hash-table">
<h1>Noddy hash table<a class="headerlink" href="#noddy-hash-table" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Hash</span><span class="kd">←</span><span class="kt">{</span><span class="nv">keys</span><span class="kd">←</span><span class="p">(</span><span class="m">1500</span><span class="na">⌶</span><span class="p">)</span><span class="o">,</span><span class="bp">⍺</span><span class="p">⋄</span><span class="nv">vals</span><span class="kd">←</span><span class="o">,</span><span class="bp">⍵</span><span class="p">⋄</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">⊣</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="nv">Vals</span> <span class="nv">Keys</span> <span class="nv">Default</span><span class="p">)</span><span class="kd">←</span><span class="nv">vals</span> <span class="nv">keys</span> <span class="no">⍬</span><span class="kt">}</span><span class="nf">⎕NS</span><span class="s1">&#39;&#39;</span><span class="kt">}</span>
<span class="nv">In</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍺</span><span class="o">∊</span><span class="bp">⍵</span><span class="na">.</span><span class="nv">Keys</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Get</span><span class="kd">←</span><span class="kt">{</span>
    <span class="o">~</span><span class="bp">⍵</span> <span class="nv">In</span> <span class="bp">⍺:⍺</span><span class="na">.</span><span class="nv">Default</span>
    <span class="bp">⍺</span><span class="na">.</span><span class="nv">Vals</span><span class="sr">[</span><span class="bp">⍺</span><span class="na">.</span><span class="nv">Keys</span><span class="o">⍳</span><span class="bp">⍵</span><span class="sr">]</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Set</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Upsert ht ⍺ with kv pair ⍵. ⍝ Returns 1 if this is a new key; 0 otherwise.</span>
    <span class="nv">ht</span><span class="kd">←</span><span class="bp">⍺</span>
    <span class="p">(</span><span class="nv">k</span> <span class="nv">v</span><span class="p">)</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">i</span><span class="kd">←</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="o">⍳⊂</span><span class="nv">k</span>
    <span class="nv">i</span><span class="o">=≢</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="bp">:</span><span class="m">1</span><span class="o">⊣</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="o">,</span><span class="kd">←</span><span class="o">⊂</span><span class="nv">k</span><span class="o">⊣</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Vals</span><span class="o">,</span><span class="kd">←</span><span class="nv">v</span> <span class="c1">⍝ New key</span>
    <span class="nv">ht</span><span class="na">.</span><span class="nv">Vals</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span><span class="kd">←</span><span class="nv">v</span>                        <span class="c1">⍝ Replace existing</span>
    <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span>
<span class="nv">Append</span><span class="kd">←</span><span class="kt">{</span> <span class="c1">⍝ Append a value to those belonging to the key. If new key, insert kv pair</span>
    <span class="nv">ht</span><span class="kd">←</span><span class="bp">⍺</span>
    <span class="p">(</span><span class="nv">k</span> <span class="nv">v</span><span class="p">)</span><span class="kd">←</span><span class="bp">⍵</span>
    <span class="nv">i</span><span class="kd">←</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="o">⍳⊂</span><span class="nv">k</span>
    <span class="nv">i</span><span class="o">=≢</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="bp">:</span><span class="m">1</span><span class="o">⊣</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Keys</span><span class="o">,</span><span class="kd">←</span><span class="o">⊂</span><span class="nv">k</span><span class="o">⊣</span><span class="nv">ht</span><span class="na">.</span><span class="nv">Vals</span><span class="o">,</span><span class="kd">←</span><span class="nv">v</span> <span class="c1">⍝ New key</span>
    <span class="nv">ht</span><span class="na">.</span><span class="nv">Vals</span><span class="sr">[</span><span class="nv">i</span><span class="sr">]</span><span class="o">,</span><span class="kd">←</span><span class="nv">v</span>                       <span class="c1">⍝ Append to existing</span>
    <span class="m">0</span>
<span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="space-ship-compares">
<h2>Space ship compares (&lt;=&gt;)<a class="headerlink" href="#space-ship-compares" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">ssc1</span><span class="kd">←</span><span class="kt">{</span><span class="o">⊃</span><span class="m">¯1</span> <span class="m">0</span> <span class="m">1</span><span class="sr">[</span><span class="o">⍸</span><span class="bp">⍺</span><span class="p">(</span><span class="o">&lt;,=,&gt;</span><span class="p">)</span><span class="bp">⍵</span><span class="sr">]</span><span class="kt">}</span>
<span class="nv">ssc2</span><span class="kd">←</span><span class="o">&gt;-&lt;</span>
<span class="nv">ssc3</span><span class="kd">←</span><span class="o">×-</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="tuples">
<h2>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">tuples</span><span class="kd">←</span><span class="kt">{</span><span class="o">↓</span><span class="p">(</span><span class="bp">⍺</span><span class="o">÷</span><span class="na">⍨</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span> <span class="bp">⍺</span><span class="o">⍴</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ errors if not equally dividable</span>
<span class="nv">tuples</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="o">⊂</span><span class="na">⍨</span><span class="p">(</span><span class="o">≢</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⍴</span><span class="bp">⍺</span><span class="o">↑</span><span class="m">1</span><span class="kt">}</span>
<span class="nv">tuples</span><span class="kd">←</span><span class="o">⊢⊂</span><span class="na">⍨</span><span class="o">≢</span><span class="na">⍤</span><span class="o">⊢⍴⊣↑≢</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="indices-of-unique">
<h2>Indices of unique<a class="headerlink" href="#indices-of-unique" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍸≠</span> <span class="m">1</span> <span class="m">1</span> <span class="m">2</span> <span class="m">1</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">2</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│0 2 4 5 6│
└~────────┘
</span></div></div>
</div>
</div>
<div class="section" id="namespace-as-dict">
<h2>Namespace as dict<a class="headerlink" href="#namespace-as-dict" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span>_Gets←{⍎&#39;⍺⍺.&#39;,⍺,&#39;←⍵&#39;⊣⍺⍺}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span>ns←⎕ns&#39;&#39;
&#39;hello&#39;(ns _Gets)&#39;world&#39;
ns.hello
ns⍎&#39;hello&#39;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│world│
└─────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
│world│
└─────┘
</span></div></div>
</div>
</div>
<div class="section" id="mapping-between-2d-and-1d-coordinates">
<h2>Mapping between 2D and 1D coordinates<a class="headerlink" href="#mapping-between-2d-and-1d-coordinates" title="Permalink to this headline">¶</a></h2>
<p>When you flatten (,⍵) a matrix m with shape ⍴m its set of coordinates changes from ⍳⍴m to ⍳×/⍴m. They become simply the indices of a vector. The mapping between the two can be done with k←(⍴m)⊥i j and its inverse i j←(⍴m)⊤k, where i j are a pair of indices in m, and k is an index in ,m</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">m</span><span class="kd">←</span><span class="m">3</span> <span class="m">5</span> <span class="o">⍴</span><span class="m">15</span><span class="o">?</span><span class="m">15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→───────────┐
↓5  0 10 13 6│
│3  9  8 12 1│
│2 14 11  4 7│
└~───────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">ravel</span><span class="kd">←</span><span class="o">,</span><span class="nv">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→─────────────────────────────────┐
│5 0 10 13 6 3 9 8 12 1 2 14 11 4 7│
└~─────────────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">k</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴</span><span class="nv">m</span><span class="p">)</span><span class="o">⊥</span><span class="m">1</span> <span class="m">4</span> <span class="c1">⍝ 2D to 1D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
9

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">k</span><span class="o">⊃</span><span class="nv">ravel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
1

</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">i</span> <span class="nv">j</span><span class="kd">←</span><span class="p">(</span><span class="o">⍴</span><span class="nv">m</span><span class="p">)</span><span class="o">⊤</span><span class="nv">k</span> <span class="c1">⍝ 1D to 2D</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
│1 4│
└~──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">m</span><span class="sr">[</span><span class="o">⊂</span><span class="nv">i</span> <span class="nv">j</span><span class="sr">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace"> 
1

</span></div></div>
</div>
</div>
<div class="section" id="generalised-padding">
<h2>Generalised padding<a class="headerlink" href="#generalised-padding" title="Permalink to this headline">¶</a></h2>
<p>Center a matrix of rank n in a larger matrix of rank n+1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">d</span><span class="kd">←</span><span class="m">3</span> <span class="m">3</span><span class="o">⍴</span><span class="m">0</span> <span class="m">1</span> <span class="m">0</span> <span class="m">0</span> <span class="m">0</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span> <span class="m">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
↓0 1 0│
│0 0 1│
│1 1 1│
└~────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad</span><span class="kd">←</span><span class="kt">{</span><span class="p">(</span><span class="o">-</span><span class="bp">⍵</span><span class="o">+</span><span class="bp">⍵</span><span class="o">+⍴</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="p">(</span><span class="bp">⍵</span><span class="o">+⍴</span><span class="bp">⍺</span><span class="p">)</span><span class="o">↑</span><span class="bp">⍺</span><span class="kt">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">d</span> <span class="nv">Pad</span> <span class="m">5</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
↓0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 1 0 0 0 0 0 0│
│0 0 0 0 0 0 0 1 0 0 0 0 0│
│0 0 0 0 0 1 1 1 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
└~────────────────────────┘
</span></div></div>
</div>
<p>Here’s a different approach:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad2</span><span class="kd">←</span><span class="kt">{</span><span class="bp">⍵</span><span class="na">@</span><span class="p">(</span><span class="m">1</span><span class="o">+⍳⍴</span><span class="bp">⍵</span><span class="p">)</span><span class="o">⊢</span><span class="m">0</span><span class="o">⍴</span><span class="na">⍨</span><span class="m">2</span><span class="o">+⍴</span><span class="bp">⍵</span><span class="kt">}</span> <span class="c1">⍝ https://aplcart.info/?q=surround%20array#</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad2</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
│0 1 2 3 0│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad2</span> <span class="nv">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────┐
↓0 0 0 0 0│
│0 0 1 0 0│
│0 0 0 1 0│
│0 1 1 1 0│
│0 0 0 0 0│
└~────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad2</span><span class="na">⍣</span><span class="m">5</span><span class="o">⊢</span><span class="nv">d</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────────────────────────┐
↓0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 1 0 0 0 0 0 0│
│0 0 0 0 0 0 0 1 0 0 0 0 0│
│0 0 0 0 0 1 1 1 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
│0 0 0 0 0 0 0 0 0 0 0 0 0│
└~────────────────────────┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">Pad2</span> <span class="p">(</span><span class="o">↑,</span><span class="na">∘</span><span class="o">⊂</span><span class="p">)</span><span class="nv">d</span> <span class="c1">⍝ Increase rank first</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌┌→────────┐
↓↓0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
││         │
││0 0 0 0 0│
││0 0 1 0 0│
││0 0 0 1 0│
││0 1 1 1 0│
││0 0 0 0 0│
││         │
││0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
││0 0 0 0 0│
└└~────────┘
</span></div></div>
</div>
</div>
<div class="section" id="todo">
<h2>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h2>
<p>&#64;voidhawk on AoC Day16</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="kd">←</span><span class="m">1</span> <span class="c1">⍝ voidhawk</span>
<span class="nv">p</span><span class="kd">←</span><span class="p">(</span><span class="o">⊢⊆</span><span class="na">⍨</span><span class="m">0</span><span class="o">≠≢</span><span class="na">¨</span><span class="p">)</span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;data/2020/day16.txt&#39;</span><span class="m">1</span>
<span class="nv">ds</span><span class="kd">←</span><span class="kt">{</span><span class="o">⍎</span><span class="na">¨</span><span class="bp">⍵</span><span class="p">(</span><span class="o">∊⊆⊣</span><span class="p">)</span><span class="nf">⎕D</span><span class="kt">}</span>
<span class="nv">rs</span><span class="kd">←</span><span class="nv">ds</span><span class="na">¨</span><span class="o">⊃</span><span class="nv">p</span> <span class="p">⋄</span> <span class="nv">yt</span> <span class="nv">ot</span><span class="kd">←</span><span class="kt">{</span><span class="o">↑</span><span class="nv">ds</span><span class="na">¨</span><span class="m">1</span><span class="o">↓</span><span class="bp">⍵</span><span class="o">⊃</span><span class="nv">p</span><span class="kt">}</span><span class="na">¨</span><span class="m">2</span> <span class="m">3</span>
<span class="nv">ir</span><span class="kd">←</span><span class="kt">{</span><span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span> <span class="nv">d</span><span class="kd">←</span><span class="bp">⍵</span> <span class="p">⋄</span> <span class="p">((</span><span class="nv">d</span><span class="o">≥</span><span class="bp">⍺</span><span class="p">)</span><span class="o">∧</span><span class="nv">c</span><span class="o">≤</span><span class="bp">⍺</span><span class="p">)</span><span class="o">∨</span><span class="p">(</span><span class="nv">b</span><span class="o">≥</span><span class="bp">⍺</span><span class="p">)</span><span class="o">∧</span><span class="nv">a</span><span class="o">≤</span><span class="bp">⍺</span><span class="kt">}</span>
<span class="o">+</span><span class="na">/</span><span class="nv">ot</span><span class="sr">[</span><span class="o">⍸~</span><span class="nv">e</span><span class="kd">←</span><span class="o">∨</span><span class="na">/</span><span class="nv">ot</span><span class="na">∘.</span><span class="nv">ir</span> <span class="nv">rs</span><span class="sr">]</span> <span class="c1">⍝ part 1</span>
<span class="nv">m</span><span class="kd">←</span><span class="o">∧</span><span class="na">⌿</span><span class="nv">rs</span><span class="na">∘.</span><span class="nv">ir</span><span class="na">⍨</span><span class="nv">yt</span><span class="o">⍪</span><span class="nv">ot</span><span class="na">⌿⍨</span><span class="o">∧</span><span class="na">/</span><span class="nv">e</span>
<span class="o">×</span><span class="na">/</span><span class="m">6</span><span class="o">↑</span><span class="p">(</span><span class="o">,</span><span class="nv">yt</span><span class="p">)</span><span class="o">⌷</span><span class="na">⍨</span><span class="o">⊂⍋</span><span class="p">(</span><span class="o">⊂⍋⍋+</span><span class="na">/</span><span class="nv">m</span><span class="p">)</span><span class="o">⌷∊~</span><span class="na">⍨\</span><span class="o">⍸</span><span class="na">¨</span><span class="o">↓</span><span class="nv">m</span><span class="sr">[</span><span class="o">⍋+</span><span class="na">/</span><span class="nv">m</span><span class="sr">;]</span> <span class="c1">⍝ part 2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FILE NAME ERROR: data/2020/day16.txt: Unable to open file (&quot;No such file or directory&quot;)
      p←(⊢⊆⍨0≠≢¨)⊃⎕NGET&#39;data/2020/day16.txt&#39; 1
                  ∧
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: p
      rs←ds¨⊃p ⋄ yt ot←{↑ds¨1↓⍵⊃p}¨2 3
             ∧
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: ot
      +/ot[⍸~e←∨/ot∘.ir rs] ⍝ part 1
                 ∧
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: e
      m←∧⌿rs∘.ir⍨yt⍪ot⌿⍨∧/e
                          ∧
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>VALUE ERROR: Undefined name: yt
      ×/6↑(,yt)⌷⍨⊂⍋(⊂⍋⍋+/m)⌷∊~⍨\⍸¨↓m[⍋+/m;] ⍝ part 2
            ∧
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="corners-of-2d-array">
<h2>Corners of 2D Array<a class="headerlink" href="#corners-of-2d-array" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊢</span><span class="nv">m</span><span class="kd">←</span><span class="m">3</span> <span class="m">3</span><span class="o">⍴</span><span class="m">9</span><span class="o">?</span><span class="m">9</span>
<span class="kt">{</span><span class="o">↑</span><span class="p">(</span><span class="o">⊣</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)(</span><span class="o">⊢</span><span class="na">/</span><span class="bp">⍵</span><span class="p">)</span><span class="kt">}</span><span class="na">⍣</span><span class="m">2</span><span class="o">⊢</span><span class="nv">m</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→────┐
↓1 3 9│
│8 2 4│
│7 5 6│
└~────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌→──┐
↓1 9│
│7 6│
└~──┘
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⌷</span><span class="na">⍨∘</span><span class="o">⊃</span><span class="na">⍨⍤</span><span class="m">0</span> <span class="m">99</span> <span class="c1">⍝ Sane indexing</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">      ⍤    
     ┌┴┐   
     ⍨ 0 99
   ┌─┘     
   ∘       
  ┌┴┐      
  ⍨ ⊃      
┌─┘        
⌷          
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">⊢⊂</span><span class="na">⍨</span><span class="m">1</span><span class="o">,</span><span class="m">2</span><span class="o">≠</span><span class="na">/</span><span class="o">⊢</span><span class="p">)</span> <span class="c1">⍝ map of changes</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┼───┐      
⊢ ⍨ ┌─┼───┐  
┌─┘ 1 , ┌─┼─┐
⊂       2 / ⊢
        ┌─┘  
        ≠    
</span></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">∨</span><span class="na">.</span><span class="o">∧</span><span class="na">⍨</span><span class="o">∨⊢</span><span class="p">)</span><span class="na">⍣</span><span class="o">≡</span> <span class="c1">⍝ Transitive closure on APL Cart?</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">       ⍣  
     ┌─┴─┐
   ┌─┼─┐ ≡
   ⍨ ∨ ⊢  
 ┌─┘      
 .        
┌┴┐       
∨ ∧       
</span></div></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="notebooks.html" title="previous page">Content with notebooks</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By APL Industrial Array and Magic<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>