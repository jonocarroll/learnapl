
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dealing with real data &#8212; Learning APL</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="HttpCommand" href="http.html" />
    <link rel="prev" title="Namespaces ⎕NS" href="namespaces.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo2.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Learning APL</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="array.html">
   It’s arrays all the way down
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="indexing.html">
   Indexing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="manip.html">
   Glyphiary
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="functions.html">
   Direct functions and operators
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="iteration.html">
   Iteration
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="key.html">
   The Key operator:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⌸
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="at.html">
   The At operator:
   <code class="docutils literal notranslate">
    <span class="pre">
     @
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rank.html">
   The Rank/Atop operator:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⍤
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stencil.html">
   The Stencil operator:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⌺
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="over.html">
   The Över operator:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⍥
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dyadictrn.html">
   Dyadic transpose:
   <code class="docutils literal notranslate">
    <span class="pre">
     A⍉B
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="decode.html">
   Encode decode:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⊤⊥
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="products.html">
   Products
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tacit.html">
   Trainspotting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="find.html">
   Finding things
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cookbook1.html">
   Partitions
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="errors.html">
   Error handling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="aplway.html">
   The APL Way
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="namespaces.html">
   Namespaces
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕NS
    </span>
   </code>
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Dealing with real data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="http.html">
   HttpCommand
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dfnsws.html">
   The dfns workspace
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="testing.html">
   Testing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workflow.html">
   A Dyalog workflow. Or two.
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="next.html">
   What now?
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tldr.html">
   Too long; didn’t read
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/xpqz/learnapl"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/xpqz/learnapl/issues/new?title=Issue%20on%20page%20%2Fio.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/io.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-text-files-nget">
   Reading text files:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕NGET
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-csv-csv">
   Reading CSV:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕CSV
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-json-json">
   Reading JSON:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕JSON
    </span>
   </code>
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Dealing with real data</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-text-files-nget">
   Reading text files:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕NGET
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-csv-csv">
   Reading CSV:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕CSV
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reading-json-json">
   Reading JSON:
   <code class="docutils literal notranslate">
    <span class="pre">
     ⎕JSON
    </span>
   </code>
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="dealing-with-real-data">
<h1>Dealing with real data<a class="headerlink" href="#dealing-with-real-data" title="Permalink to this headline">#</a></h1>
<blockquote>
<div><p>You want it in one line? Does it have to fit in 80 columns?
–<em>Larry Wall</em></p>
</div></blockquote>
<p>Amazingly, we got all the way to here without once mentioning how to get data in (or out) with less than typing it in. Nor have we dealt with “real” data much. Real data is usually messy. Dyalog APL has a rich set of routines to deal with data, either as bytes on disk, or formatted as JSON or CSV (or XML, but let’s keep pretending that XML was never actually a thing), or fetching it from a database, or as an HTTP-request. Some of this stuff we won’t cover – if you need it, you’re probably capable enough as an APLer to figure it out yourself.</p>
<p>Some other resources to consult:</p>
<ul class="simple">
<li><p>Docs on <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/nget.htm">⎕NGET</a>, <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/csv.htm">⎕CSV</a>, <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/json.htm">⎕JSON</a> and (if you must) <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/xml.htm">⎕XML</a></p></li>
<li><p>Dyalog <a class="reference external" href="https://dyalog.tv/Webinar/?v=yDpRGaheEH4">webinar</a> on http, <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code> and <code class="docutils literal notranslate"><span class="pre">⎕XML</span></code></p></li>
</ul>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕IO</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="m">0</span><span class="w"></span>
<span class="sr">]</span><span class="nv">box</span><span class="w"> </span><span class="nv">on</span><span class="w"></span>
<span class="sr">]</span><span class="nv">rows</span><span class="w"> </span><span class="nv">on</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">Was ON
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">Was OFF
</span></div></div>
</div>
<section id="reading-text-files-nget">
<h2>Reading text files: <code class="docutils literal notranslate"><span class="pre">⎕NGET</span></code><a class="headerlink" href="#reading-text-files-nget" title="Permalink to this headline">#</a></h2>
<p>The system function <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/nget.htm">⎕NGET</a> reads text files from disk:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;/Users/stefan/work/dyalog/file.txt&#39;</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────┬───────────────┬───────────────┬───────────────┐
│1 8 6 9 5 9 5 9│6 3 4 2 8 1 8 2│8 0 7 5 5 1 2 3│6 5 2 9 8 2 6 1│
└───────────────┴───────────────┴───────────────┴───────────────┘
</span></div></div>
</div>
<p>We can note two things from that:</p>
<ol class="simple">
<li><p>We disclose the result (actually, we pick the first item)</p></li>
<li><p>There is a <code class="docutils literal notranslate"><span class="pre">1</span></code> after the file name</p></li>
</ol>
<p>Let’s explore what happens if we don’t do these things.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NGET</span><span class="s1">&#39;/Users/stefan/work/dyalog/file.txt&#39;</span><span class="m">1</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─────────────────────────────────────────────────────────────────┬───────────┬──┐
│┌───────────────┬───────────────┬───────────────┬───────────────┐│UTF-8-NOBOM│10│
││1 8 6 9 5 9 5 9│6 3 4 2 8 1 8 2│8 0 7 5 5 1 2 3│6 5 2 9 8 2 6 1││           │  │
│└───────────────┴───────────────┴───────────────┴───────────────┘│           │  │
└─────────────────────────────────────────────────────────────────┴───────────┴──┘
</span></div></div>
</div>
<p>We can see that when we read a file with <code class="docutils literal notranslate"><span class="pre">⎕NGET</span></code> we get back a vector with several elements, the first is the data itself, and the second contains information about the file’s encoding. The last one is Dyalog’s opinion of what the file’s newline separator is. This will vary across operating systems.</p>
<p>What happens if we leave out the <code class="docutils literal notranslate"><span class="pre">1</span></code> at the end?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕NGET</span><span class="s1">&#39;/Users/stefan/work/dyalog/file.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───────────────┬───────────┬──┐
│1 8 6 9 5 9 5 9│UTF-8-NOBOM│10│
│6 3 4 2 8 1 8 2│           │  │
│8 0 7 5 5 1 2 3│           │  │
│6 5 2 9 8 2 6 1│           │  │
│               │           │  │
└───────────────┴───────────┴──┘
</span></div></div>
</div>
<p>Leaving out the <code class="docutils literal notranslate"><span class="pre">1</span></code> (or indeed instead passing the default value of <code class="docutils literal notranslate"><span class="pre">0</span></code>) returns a single character vector containing the data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍴⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;/Users/stefan/work/dyalog/file.txt&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">64
</span></div></div>
</div>
<p>This is probably not what you want in most cases when processing a text file. Note that we’ve read lines of <em>characters</em>. But we can convert them to numbers:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍎</span><span class="na">⍤</span><span class="m">1</span><span class="o">⊢↑⊃</span><span class="nf">⎕NGET</span><span class="s1">&#39;/Users/stefan/work/dyalog/file.txt&#39;</span><span class="m">1</span><span class="w"> </span><span class="c1">⍝ Note health warning below!</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 8 6 9 5 9 5 9
6 3 4 2 8 1 8 2
8 0 7 5 5 1 2 3
6 5 2 9 8 2 6 1
</span></div></div>
</div>
<p>We mixed the vector into an array of rank 2, then applied the <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/Symbols/Execute%20Symbol.htm"><em>Hydrant</em></a>, <code class="docutils literal notranslate"><span class="pre">⍎</span></code> at rank 1 (vectors). <em>Hydrant</em> is a function called  <em>Execute</em>, and it takes a string and evaluates it as if it was a little APL program, similar to how <a class="reference external" href="https://docs.python.org/3/library/functions.html#eval">eval()</a> works in Python and Perl:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="o">⍎</span><span class="w"> </span><span class="s1">&#39;1 8 6 7 5 9 5 9&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1 8 6 7 5 9 5 9
</span></div></div>
</div>
<p>If you have ever seen code written in <a class="reference external" href="https://www.php.net/manual/en/intro-whatis.php">PHP</a>, you know why evaluating strings requires a degree of <a class="reference external" href="https://www.php.net/manual/en/security.database.sql-injection.php">caution</a> unless you’re certain of the provenance. Perl has a <a class="reference external" href="https://perldoc.perl.org/perlsec#Taint-mode">taint</a> mode to stop bleed-over from untrusted sources, and Python papers over the issue by decree, calling <code class="docutils literal notranslate"><span class="pre">eval()</span></code> un-Pythonic, and Guido-hated.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Dyalog provides more industry-strength mechanisms for converting strings to numbers in a safe manner, like <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/vfi.htm">verify-fix-input</a>, <code class="docutils literal notranslate"><span class="pre">⎕VFI</span></code></p>
</div>
<p>Anyway, enough of the yak shaving already.</p>
</section>
<section id="reading-csv-csv">
<h2>Reading CSV: <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code><a class="headerlink" href="#reading-csv-csv" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Comma-separated_values">CSV</a>, or <em>comma-separated values</em>, is a data format for tabular data. It’s <a class="reference external" href="http://thomasburette.com/blog/2014/05/25/so-you-want-to-write-your-own-CSV-code/">hairier than one might think</a> to write a correct CSV parser. Fortunately, Dyalog provides one for us as the system function <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/csv.htm">⎕CSV</a>. It can be used to convert data both to and from the CSV format. The <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> function has one extremely handy feature: it converts numbers for us, avoiding the hydrant-dance we resorted to above.</p>
<p>Consider the following decidedly not-CSV-looking data. It’s a section from the data given in Day 2 in the <a class="reference external" href="https://adventofcode.com/2020/day/2">Advent of Code</a> competition from 2020. Let’s assume we’ve already read from disk using <code class="docutils literal notranslate"><span class="pre">⎕NGET</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;3-6 s: ssdsssss&#39;</span><span class="w"> </span><span class="s1">&#39;17-19 f: cnffsfffzhfnsffttms&#39;</span><span class="w"> </span><span class="s1">&#39;8-11 c: tzvtwncnwvwttp&#39;</span><span class="w"> </span><span class="s1">&#39;8-10 r: rwrrtrvttrrrr&#39;</span><span class="w"> </span><span class="s1">&#39;1-2 p: zhpjph&#39;</span><span class="w"> </span><span class="s1">&#39;4-6 l: pldnxv&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Whilst it’s not CSV, it <em>does</em> look tabular. One handy use of <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> is to rely on it to make a table from data, and convert columns of numbers. In our case, we separate each item by converting each “non-word” character to a comma, and then ask <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to do the conversion:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nf">⎕CSV</span><span class="p">(</span><span class="s1">&#39;\W+&#39;</span><span class="nf">⎕R</span><span class="s1">&#39;,&#39;</span><span class="o">⊢</span><span class="nv">data</span><span class="p">)</span><span class="s1">&#39;&#39;</span><span class="m">4</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌──┬──┬─┬───────────────────┐
│3 │6 │s│ssdsssss           │
├──┼──┼─┼───────────────────┤
│17│19│f│cnffsfffzhfnsffttms│
├──┼──┼─┼───────────────────┤
│8 │11│c│tzvtwncnwvwttp     │
├──┼──┼─┼───────────────────┤
│8 │10│r│rwrrtrvttrrrr      │
├──┼──┼─┼───────────────────┤
│1 │2 │p│zhpjph             │
├──┼──┼─┼───────────────────┤
│4 │6 │l│pldnxv             │
└──┴──┴─┴───────────────────┘
</span></div></div>
</div>
<p>We called <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> monadically, with an argument vector containing three items. The first, in our case, is obviously the data itself. The second is called the <em>data description</em>, which is used to specify the encoding where necessary. Dyalog’s docs tells us:</p>
<blockquote>
<div><p>If omitted or empty, the file encoding is deduced</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">4</span></code> at the end of that is the <em>column specifier</em>, and this is what Dyalog’s docs have to say about it:</p>
<blockquote>
<div><p>4: The field is to be interpreted numeric data but invalid numeric data is tolerated. Empty fields and fields which cannot be converted to numeric values are returned instead as character data.</p>
</div></blockquote>
<p>We can read files containing CSV data directly with <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code>, in which case the first element of the argument vector should be a character vector containing the file name. We can also use <code class="docutils literal notranslate"><span class="pre">⎕CSV</span></code> to <em>write</em> .csv files – consult Dyalog’s docs for details.</p>
</section>
<section id="reading-json-json">
<h2>Reading JSON: <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code><a class="headerlink" href="#reading-json-json" title="Permalink to this headline">#</a></h2>
<p>Dyalog also has a function for reading (and writing) JSON, appropriately enough called <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/json.htm">⎕JSON</a>. The JSON data interchange format crops up everywhere: usually in REST-like APIs as the payload, as config files, as the document format in document-oriented databases. The name JSON is short for <em>JavaScript Object Notation</em>, and as one can expect, dealing with JSON in JavaScript is both trivial and convenient. Python’s native dictionary and list types - through luck, mostly - map pretty closely to JSON, too, making working with JSON in Python pretty simple.</p>
<p>In APL, we have a wealth of different data types: array. JSON doesn’t do arrays of rank &gt; 1. This makes a recursively defined format depending on dictionaries, like JSON, potentially more awkward to deal with. In the specific case of Dyalog APL, we do have the <em>namespace</em> which can be persuaded to act a bit like a dictionary.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Dyalog <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/json.htm">notes</a>:</p>
<p>JSON supports a limited number of data types and there is not a direct correspondence between JSON and APL data structures. In particular:</p>
<ul class="simple">
<li><p>JSON does not support arrays with rank &gt; 1.</p></li>
<li><p>The JSON standard includes Boolean values true and false which are distinct from numeric values 1 and 0, and have no direct APL equivalent.</p></li>
<li><p>The JSON5 standard includes numeric constants Infinity, -Infinity, NaN and -NaN which have no direct APL equivalent.</p></li>
<li><p>JSON objects are named and these might not be valid names in APL.</p></li>
</ul>
</div>
<p>Whilst the <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code> function does a good job given these constraints, working with JSON data (IMHO) in Dyalog always end up feeling a smidge gritty compared with JavaScript or Python.</p>
<p>Let’s look at some examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">json</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="s1">&#39;{&quot;key&quot;: 1, &quot;list&quot;: [1, 2, 3, {&quot;colour&quot;: &quot;red&quot;, &quot;shape&quot;: &quot;oblong&quot;, &quot;number&quot;: 5}, [98, 43, 77]]}&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>Yep, that’s JSON alright. Let’s convert that to APL as vectors and namespaces:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="vg">⎕</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">data</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nf">⎕JSON</span><span class="w"> </span><span class="nv">json</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">#.[JSON object]
</span></div></div>
</div>
<p>Ok, that went through without complaints, and we can see that Dyalog (correctly) thinks that the top level is “object”. We can now get at the innards of this by attribute names and indices:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="na">.</span><span class="nv">key</span><span class="w"></span>
<span class="nv">data</span><span class="na">.</span><span class="nv">list</span><span class="w"></span>
<span class="nv">data</span><span class="na">.</span><span class="nv">list</span><span class="sr">[</span><span class="m">3</span><span class="sr">]</span><span class="na">.</span><span class="nv">shape</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">1
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬─┬─┬─────────────────────────────┬────────┐
│1│2│3│#.[JSON object].[JSON object]│98 43 77│
└─┴─┴─┴─────────────────────────────┴────────┘
</span></div><div class="output text_html"><span style="white-space:pre; font-family: monospace">oblong
</span></div></div>
</div>
<p>Well, that looks perfectly smooth, right? But the unsmooth bit here is that in a JSON dict, the keys are <em>strings</em>, not object instance attributes which is what they end up as in our namespace. If we’re reading an unknown bit of JSON data where we don’t already know what the layout is, how do we, for example, process each key’s value in turn if the keys aren’t known to us?</p>
<p>We can list all keys in a namespace using the following construct, where <code class="docutils literal notranslate"><span class="pre">⎕NL</span></code> is the <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/nl.htm"><em>Name list</em></a> and the <code class="docutils literal notranslate"><span class="pre">¯2</span></code> magic number means that we want a vector back:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="na">.</span><span class="nf">⎕NL¯2</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌───┬────┐
│key│list│
└───┴────┘
</span></div></div>
</div>
<p>To get the corresponding values, we need to <em>evaluate</em> each such key:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">data</span><span class="na">.</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="nf">⎕NL¯2</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">┌─┬──────────────────────────────────────────────┐
│1│┌─┬─┬─┬─────────────────────────────┬────────┐│
│ ││1│2│3│#.[JSON object].[JSON object]│98 43 77││
│ │└─┴─┴─┴─────────────────────────────┴────────┘│
└─┴──────────────────────────────────────────────┘
</span></div></div>
</div>
<p>Let’s say that we want to sum all numbers in the JSON. Here’s one way we can achieve that:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">Values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="nv">keys</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="bp">⍵</span><span class="na">.</span><span class="nf">⎕NL¯2</span><span class="w"></span>
<span class="w">    </span><span class="nv">values</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="nv">keys</span><span class="w"> </span><span class="kt">{</span><span class="m">0</span><span class="o">=≢</span><span class="bp">⍺:</span><span class="no">⍬</span><span class="p">⋄</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="bp">⍺</span><span class="p">)</span><span class="kt">}</span><span class="w"> </span><span class="bp">⍵</span><span class="w"> </span>
<span class="w">    </span><span class="m">0</span><span class="o">=≢</span><span class="bp">⍵</span><span class="na">.</span><span class="nf">⎕NL¯9</span><span class="bp">:</span><span class="nv">values</span><span class="w">       </span><span class="c1">⍝ No nested namespaces: done</span><span class="w"></span>
<span class="w">    </span><span class="nv">values</span><span class="o">,∊</span><span class="bp">∇</span><span class="na">¨</span><span class="bp">⍵</span><span class="na">.</span><span class="p">(</span><span class="o">⍎</span><span class="na">¨</span><span class="nf">⎕NL¯9</span><span class="p">)</span><span class="w">   </span><span class="c1">⍝ Also expand any namespaces we found as values</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="sr">]</span><span class="nv">dinput</span><span class="w"></span>
<span class="nv">JSONSum</span><span class="w"> </span><span class="kd">←</span><span class="w"> </span><span class="kt">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">{</span><span class="p">(</span><span class="m">1</span><span class="o">=</span><span class="m">2</span><span class="o">|</span><span class="nf">⎕DR</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="bp">⍵:⍵</span><span class="w">                    </span><span class="c1">⍝ Are we a number?</span><span class="w"></span>
<span class="w">    </span><span class="p">(</span><span class="o">⍕≡⊢</span><span class="p">)</span><span class="bp">⍵:</span><span class="m">0</span><span class="w">                           </span><span class="c1">⍝ Are we a string?</span><span class="w"></span>
<span class="w">    </span><span class="kt">{</span><span class="p">(</span><span class="m">326</span><span class="o">=</span><span class="nf">⎕DR</span><span class="bp">⍵</span><span class="p">)</span><span class="o">∧</span><span class="p">(</span><span class="m">0</span><span class="o">=≡</span><span class="p">)</span><span class="bp">⍵</span><span class="kt">}</span><span class="w"> </span><span class="bp">⍵:</span><span class="o">+</span><span class="na">/</span><span class="bp">∇</span><span class="nv">Values</span><span class="w"> </span><span class="bp">⍵</span><span class="w">  </span><span class="c1">⍝ Are we an object?</span><span class="w"></span>
<span class="w">    </span><span class="o">+</span><span class="na">/</span><span class="o">∊</span><span class="bp">∇</span><span class="na">¨</span><span class="bp">⍵</span><span class="w">                             </span><span class="c1">⍝ We&#39;re a list</span><span class="w"></span>
<span class="kt">}</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-APL notranslate"><div class="highlight"><pre><span></span><span class="nv">JSONSum</span><span class="w"> </span><span class="nv">data</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><span style="white-space:pre; font-family: monospace">230
</span></div></div>
</div>
<p>The bits to find the type of each field in <code class="docutils literal notranslate"><span class="pre">JSONSum</span></code> are all things you can just look up on APLCart: monadic <a class="reference external" href="http://help.dyalog.com/18.0/index.htm#Language/System%20Functions/Data%20Representation%20Monadic.htm">⎕DR</a> means <em>Data representation</em>, and you just need to feed it the right magic number.</p>
<p>There is a lot more to say about the <code class="docutils literal notranslate"><span class="pre">⎕JSON</span></code> function that we won’t go into here (we’ll see a bit more of it in the next <a class="reference internal" href="http.html"><span class="doc std std-doc">chapter</span></a>). It can also convert JSON to a pure array format instead of using namespaces, and it can also be used to convert APL arrays <em>to</em> JSON. The interested reader will have plenty to go at in the Dyalog docs, and Morten’s webinar signposted at the top of this chapter.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "dyalog-kernel"
        },
        kernelOptions: {
            kernelName: "dyalog-kernel",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'dyalog-kernel'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="namespaces.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Namespaces <code class="docutils literal notranslate"><span class="pre">⎕NS</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="http.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">HttpCommand</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Stefan Kruger, Computational Array and Magic<br/>
  
    <div class="extra_footer">
      <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
  <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" />
</a></p>
<p>This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>

    </div>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>